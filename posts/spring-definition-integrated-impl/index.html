<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charset="UTF-8"><style>:where(img){height:auto}</style><meta name="viewport" content="width=device-width"><link rel="icon" type="image" href="/astro/favicon.ico"><link rel="canonical" href="https://chou401.github.io/astro/posts/spring-definition-integrated-impl/"><meta name="generator" content="Astro v4.9.2"><!-- General Meta Tags --><title>Spring | 知道的越多，才知知道的越少</title><meta name="title" content="Spring | 知道的越多，才知知道的越少"><meta name="description" content="Spring 基础知识点"><meta name="author" content="chou401"><link rel="sitemap" href="/sitemap-index.xml"><!-- Open Graph / Facebook --><meta property="og:title" content="Spring | 知道的越多，才知知道的越少"><meta property="og:description" content="Spring 基础知识点"><meta property="og:url" content="https://chou401.github.io/astro/posts/spring-definition-integrated-impl/"><meta property="og:image" content="https://chou401.github.io/posts/spring.png"><!-- Article Published/Modified time --><meta property="article:published_time" content="2022-09-25T15:20:35.000Z"><meta property="article:modified_time" content="2024-05-16T14:00:41.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://chou401.github.io/astro/posts/spring-definition-integrated-impl/"><meta property="twitter:title" content="Spring | 知道的越多，才知知道的越少"><meta property="twitter:description" content="Spring 基础知识点"><meta property="twitter:image" content="https://chou401.github.io/posts/spring.png"><!-- Google Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&amp;display=swap" rel="stylesheet"><meta name="theme-color" content=""><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script src="/astro/toggle-theme.js"></script><style>*,:before,:after{box-sizing:border-box;border:0 solid #e5e7eb}:before,:after{--tw-content:""}html,:host{-webkit-text-size-adjust:100%;tab-size:4;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{line-height:inherit;margin:0}hr{color:inherit;border-top-width:1px;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-feature-settings:normal;font-variation-settings:normal;font-family:IBM Plex Mono,monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-feature-settings:inherit;font-variation-settings:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:#0000;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{margin:0;padding:0;list-style:none}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder{opacity:1;color:#9ca3af}textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}[hidden]{display:none}:root,html[data-theme=light]{--color-fill:251,254,251;--color-text-base:40,39,40;--color-accent:0,108,172;--color-card:230,230,230;--color-card-muted:205,205,205;--color-border:236,233,233}html[data-theme=dark]{--color-fill:33,39,55;--color-text-base:234,237,243;--color-accent:255,107,1;--color-card:52,63,96;--color-card-muted:138,51,2;--color-border:171,75,8}#sun-svg,html[data-theme=dark] #moon-svg{display:none}#moon-svg,html[data-theme=dark] #sun-svg{display:block}body{--tw-bg-opacity:1;background-color:rgba(var(--color-fill),var(--tw-bg-opacity));--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity));flex-direction:column;min-height:100svh;font-family:IBM Plex Mono,monospace;display:flex}body ::selection{background-color:rgba(var(--color-accent),var(--tw-bg-opacity));--tw-bg-opacity:.7;--tw-text-opacity:1;color:rgba(var(--color-fill),var(--tw-text-opacity))}body::selection{background-color:rgba(var(--color-accent),var(--tw-bg-opacity));--tw-bg-opacity:.7;--tw-text-opacity:1;color:rgba(var(--color-fill),var(--tw-text-opacity))}section,footer{max-width:48rem;margin-left:auto;margin-right:auto;padding-left:1rem;padding-right:1rem}a{outline-offset:1px;outline-width:2px;outline-color:rgb(var(--color-accent))}a:focus-visible{outline-style:dashed;text-decoration-line:none}svg{fill:rgb(var(--color-text-base));width:1.5rem;height:1.5rem;display:inline-block}.group:hover svg{fill:rgb(var(--color-accent))}svg.icon-tabler{--tw-scale-x:1.25;--tw-scale-y:1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y));fill:#0000;stroke:currentColor;stroke-width:2px;opacity:.9;width:1.5rem;height:1.5rem;display:inline-block}.group:hover svg.icon-tabler{fill:#0000}@media (min-width:640px){svg.icon-tabler{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}}.prose :where(h1,h2,h3,h4,h5,h6,th):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important;margin-bottom:.75rem!important}.prose :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){font-style:italic}.prose :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important}.prose :where(a):not(:where([class~=not-prose],[class~=not-prose] *)){text-underline-offset:8px;--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important;text-decoration-style:dashed!important}.prose :where(a):not(:where([class~=not-prose],[class~=not-prose] *)):hover{--tw-text-opacity:1;color:rgba(var(--color-accent),var(--tw-text-opacity))}.prose :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-border-opacity:.5;opacity:.8;border-left-color:rgba(var(--color-accent),var(--tw-border-opacity))!important}.prose :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){opacity:.7;--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important}.prose :where(strong):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:rgba(var(--color-card),var(--tw-bg-opacity));--tw-bg-opacity:.75;border-radius:.25rem;padding:.25rem}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):before,.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):after{--tw-content:none!important;content:var(--tw-content)!important}.prose :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important}.prose :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){overflow-x:clip;--tw-text-opacity:1!important;color:rgba(var(--color-text-base),var(--tw-text-opacity))!important}.prose * :where(li):not(:where([class~=not-prose],[class~=not-prose] *))::marker,.prose :where(li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:rgba(var(--color-accent),var(--tw-text-opacity))!important}.prose :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.prose :where(th):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(td):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-border-opacity:1;border-width:1px;border-color:rgba(var(--color-border),var(--tw-border-opacity))}.prose :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-border-opacity:1;border-width:2px;border-color:rgba(var(--color-border),var(--tw-border-opacity));margin-left:auto;margin-right:auto;margin-top:.5rem!important;margin-bottom:.5rem!important}.prose :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){--tw-border-opacity:1!important;border-color:rgba(var(--color-border),var(--tw-border-opacity))!important}.prose a{overflow-wrap:break-word}.prose a:hover{--tw-text-opacity:1!important;color:rgba(var(--color-accent),var(--tw-text-opacity))!important}.prose thead th:first-child,tbody td:first-child,tfoot td:first-child{padding-left:.571429em}.prose h2#table-of-contents{margin-bottom:.5rem}.prose details{cursor:pointer;-webkit-user-select:none;user-select:none;--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity));display:inline-block}.prose summary{outline-offset:1px;outline-width:2px;outline-color:rgb(var(--color-accent))}.prose summary:focus-visible{outline-style:dashed;text-decoration-line:none}.prose h2#table-of-contents+p{display:none}html{overflow-y:scroll}::-webkit-scrollbar{width:.75rem}::-webkit-scrollbar-track{--tw-bg-opacity:1;background-color:rgba(var(--color-fill),var(--tw-bg-opacity))}::-webkit-scrollbar-thumb{--tw-bg-opacity:1;background-color:rgba(var(--color-card),var(--tw-bg-opacity))}::-webkit-scrollbar-thumb:hover{--tw-bg-opacity:1;background-color:rgba(var(--color-card-muted),var(--tw-bg-opacity))}code,blockquote{word-wrap:break-word}pre>code{white-space:pre}*,:before,:after,::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:#3b82f680;--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%}@media (min-width:640px){.container{max-width:640px}}.prose{color:var(--tw-prose-body);max-width:65ch}.prose :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em;margin-bottom:1.25em}.prose :where([class~=lead]):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-lead);margin-top:1.2em;margin-bottom:1.2em;font-size:1.25em;line-height:1.6}.prose :where(a):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-links);font-weight:500;text-decoration:underline}.prose :where(strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.prose :where(a strong):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(blockquote strong):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(thead th strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em;margin-bottom:1.25em;padding-inline-start:1.625em;list-style-type:decimal}.prose :where(ol[type=A]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=A s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=I]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type=I s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type="1"]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal}.prose :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em;margin-bottom:1.25em;padding-inline-start:1.625em;list-style-type:disc}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.prose :where(dt):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);margin-top:1.25em;font-weight:600}.prose :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-top:3em;margin-bottom:3em}.prose :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-quotes);border-inline-start-width:.25rem;border-inline-start-color:var(--tw-prose-quote-borders);quotes:"“""”""‘""’";margin-top:1.6em;margin-bottom:1.6em;padding-inline-start:1em;font-style:italic;font-weight:500}.prose :where(blockquote p:first-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:open-quote}.prose :where(blockquote p:last-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:close-quote}.prose :where(h1):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);margin-top:0;margin-bottom:.888889em;font-size:2.25em;font-weight:800;line-height:1.11111}.prose :where(h1 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:900}.prose :where(h2):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);margin-top:2em;margin-bottom:1em;font-size:1.5em;font-weight:700;line-height:1.33333}.prose :where(h2 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:800}.prose :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);margin-top:1.6em;margin-bottom:.6em;font-size:1.25em;font-weight:600;line-height:1.6}.prose :where(h3 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(h4):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);margin-top:1.5em;margin-bottom:.5em;font-weight:600;line-height:1.5}.prose :where(h4 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:2em;margin-bottom:2em}.prose :where(picture):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:2em;margin-bottom:2em;display:block}.prose :where(video):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:2em;margin-bottom:2em}.prose :where(kbd):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-kbd);box-shadow:0 0 0 1px rgb(var(--tw-prose-kbd-shadows)/10%),0 3px rgb(var(--tw-prose-kbd-shadows)/10%);padding-top:.1875em;padding-inline-end:.375em;padding-bottom:.1875em;border-radius:.3125rem;padding-inline-start:.375em;font-family:inherit;font-size:.875em;font-weight:500}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.875em;font-weight:600}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):before,.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:"`"}.prose :where(a code):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(h1 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h2 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.875em}.prose :where(h3 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.9em}.prose :where(h4 code):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(blockquote code):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(thead th code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(pre):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:var(--tw-prose-pre-bg);padding-top:.857143em;padding-inline-end:1.14286em;padding-bottom:.857143em;border-radius:.375rem;margin-top:1.71429em;margin-bottom:1.71429em;padding-inline-start:1.14286em;font-size:.875em;font-weight:400;line-height:1.71429;overflow-x:auto}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)){font-weight:inherit;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit;background-color:#0000;border-width:0;border-radius:0;padding:0}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):before,.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:none}.prose :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){table-layout:auto;text-align:start;width:100%;margin-top:2em;margin-bottom:2em;font-size:.875em;line-height:1.71429}.prose :where(thead):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-width:1px;border-bottom-color:var(--tw-prose-th-borders)}.prose :where(thead th):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);vertical-align:bottom;padding-inline-end:.571429em;padding-bottom:.571429em;padding-inline-start:.571429em;font-weight:600}.prose :where(tbody tr):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-width:1px;border-bottom-color:var(--tw-prose-td-borders)}.prose :where(tbody tr:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-width:0}.prose :where(tbody td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:baseline}.prose :where(tfoot):not(:where([class~=not-prose],[class~=not-prose] *)){border-top-width:1px;border-top-color:var(--tw-prose-th-borders)}.prose :where(tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:top}.prose :where(figure>*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0;margin-bottom:0}.prose :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-captions);margin-top:.857143em;font-size:.875em;line-height:1.42857}.prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-kbd:#111827;--tw-prose-kbd-shadows:17 24 39;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-kbd:#fff;--tw-prose-invert-kbd-shadows:255 255 255;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:#00000080;--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.prose :where(picture>img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0;margin-bottom:0}.prose :where(li):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.5em;margin-bottom:.5em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.375em}.prose :where(.prose>ul>li p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.75em;margin-bottom:.75em}.prose :where(.prose>ul>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ul>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(.prose>ol>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ol>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.75em;margin-bottom:.75em}.prose :where(dl):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em;margin-bottom:1.25em}.prose :where(dd):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.5em;padding-inline-start:1.625em}.prose :where(hr+*):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(h2+*):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(h3+*):not(:where([class~=not-prose],[class~=not-prose] *)),.prose :where(h4+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(thead th:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose :where(thead th:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose :where(tbody td,tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){padding-top:.571429em;padding-inline-end:.571429em;padding-bottom:.571429em;padding-inline-start:.571429em}.prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose :where(figure):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:2em;margin-bottom:2em}.prose :where(.prose>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(.prose>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0}.display-none{display:none}.focus-outline{outline-offset:1px;outline-width:2px;outline-color:rgb(var(--color-accent))}.focus-outline:focus-visible{outline-style:dashed;text-decoration-line:none}.sr-only{clip:rect(0,0,0,0);white-space:nowrap;border-width:0;width:1px;height:1px;margin:-1px;padding:0;position:absolute;overflow:hidden}.pointer-events-none{pointer-events:none}.visible{visibility:visible}.invisible{visibility:hidden}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-y-0{top:0;bottom:0}.-top-3{top:-.75rem}.-top-full{top:-100%}.left-0{left:0}.left-16{left:4rem}.right-3{right:.75rem}.z-50{z-index:50}.col-span-2{grid-column:span 2/span 2}.m-1{margin:.25rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.my-2{margin-top:.5rem;margin-bottom:.5rem}.my-3{margin-top:.75rem;margin-bottom:.75rem}.my-4{margin-top:1rem;margin-bottom:1rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.my-8{margin-top:2rem;margin-bottom:2rem}.-mr-5{margin-right:-1.25rem}.mb-1{margin-bottom:.25rem}.mb-14{margin-bottom:3.5rem}.mb-2{margin-bottom:.5rem}.mb-28{margin-bottom:7rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-2{margin-left:.5rem}.ml-4{margin-left:1rem}.mr-2{margin-right:.5rem}.mr-4{margin-right:1rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-8{margin-top:2rem}.mt-auto{margin-top:auto}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.h-6{height:1.5rem}.w-44{width:11rem}.w-6{width:1.5rem}.w-full{width:100%}.min-w-\[1\.375rem\]{min-width:1.375rem}.max-w-3xl{max-width:48rem}.flex-1{flex:1}.rotate-90{--tw-rotate:90deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x:1;--tw-scale-y:1;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.scale-125{--tw-scale-x:1.25;--tw-scale-y:1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.scale-75{--tw-scale-x:.75;--tw-scale-y:.75;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.scale-90{--tw-scale-x:.9;--tw-scale-y:.9;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.scale-95{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.select-none{-webkit-user-select:none;user-select:none}.resize{resize:both}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-rows-4{grid-template-rows:repeat(4,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:.25rem}.gap-6{gap:1.5rem}.gap-x-2{-moz-column-gap:.5rem;column-gap:.5rem}.gap-y-2{row-gap:.5rem}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(.5rem*var(--tw-space-x-reverse));margin-left:calc(.5rem*calc(1 - var(--tw-space-x-reverse)))}.self-end{align-self:flex-end}.scroll-smooth{scroll-behavior:smooth}.whitespace-nowrap{white-space:nowrap}.text-nowrap{text-wrap:nowrap}.rounded{border-radius:.25rem}.border{border-width:1px}.border-skin-fill{--tw-border-opacity:1;border-color:rgba(var(--color-text-base),var(--tw-border-opacity))}.border-skin-line{--tw-border-opacity:1;border-color:rgba(var(--color-border),var(--tw-border-opacity))}.border-opacity-40{--tw-border-opacity:.4}.bg-skin-accent{--tw-bg-opacity:1;background-color:rgba(var(--color-accent),var(--tw-bg-opacity))}.bg-skin-card{--tw-bg-opacity:1;background-color:rgba(var(--color-card),var(--tw-bg-opacity))}.bg-skin-fill{--tw-bg-opacity:1;background-color:rgba(var(--color-fill),var(--tw-bg-opacity))}.fill-skin-accent{fill:rgb(var(--color-accent))}.fill-skin-base{fill:rgb(var(--color-text-base))}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.px-0{padding-left:0;padding-right:0}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pb-6{padding-bottom:1.5rem}.pl-10{padding-left:2.5rem}.pl-2{padding-left:.5rem}.pr-2{padding-right:.5rem}.pr-3{padding-right:.75rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-9xl{font-size:8rem;line-height:1}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.lowercase{text-transform:lowercase}.capitalize{text-transform:capitalize}.italic{font-style:italic}.leading-4{line-height:1rem}.tracking-wider{letter-spacing:.05em}.text-skin-accent{--tw-text-opacity:1;color:rgba(var(--color-accent),var(--tw-text-opacity))}.text-skin-base{--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.text-skin-inverted{--tw-text-opacity:1;color:rgba(var(--color-fill),var(--tw-text-opacity))}.underline{text-decoration-line:underline}.decoration-dashed{text-decoration-style:dashed}.decoration-wavy{text-decoration-style:wavy}.decoration-2{text-decoration-thickness:2px}.underline-offset-4{text-underline-offset:4px}.underline-offset-8{text-underline-offset:8px}.opacity-50{opacity:.5}.opacity-75{opacity:.75}.opacity-80{opacity:.8}.filter{filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.transition-all{transition-property:all;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-opacity{transition-property:opacity;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-75{transition-duration:75ms}.placeholder\:italic::placeholder{font-style:italic}.placeholder\:text-opacity-75::placeholder{--tw-text-opacity:.75}.hover\:-top-0:hover{top:0}.hover\:-top-0\.5:hover{top:-.125rem}.hover\:rotate-12:hover{--tw-rotate:12deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.hover\:rotate-6:hover{--tw-rotate:6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.hover\:text-skin-accent:hover{--tw-text-opacity:1;color:rgba(var(--color-accent),var(--tw-text-opacity))}.hover\:text-skin-base:hover{--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.hover\:underline:hover{text-decoration-line:underline}.hover\:opacity-75:hover{opacity:.75}.focus\:border-skin-accent:focus{--tw-border-opacity:1;border-color:rgba(var(--color-accent),var(--tw-border-opacity))}.focus\:outline-none:focus{outline-offset:2px;outline:2px solid #0000}.focus-visible\:no-underline:focus-visible{text-decoration-line:none}.focus-visible\:underline-offset-0:focus-visible{text-underline-offset:0px}.group:hover .group-hover\:inline-block{display:inline-block}.prose-img\:border-0 :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){border-width:0}@media (min-width:640px){.sm\:static{position:static}.sm\:my-0{margin-top:0;margin-bottom:0}.sm\:my-8{margin-top:2rem;margin-bottom:2rem}.sm\:mb-3{margin-bottom:.75rem}.sm\:ml-0{margin-left:0}.sm\:ml-2{margin-left:.5rem}.sm\:mt-0{margin-top:0}.sm\:inline{display:inline}.sm\:flex{display:flex}.sm\:hidden{display:none}.sm\:w-1\/2{width:50%}.sm\:w-auto{width:auto}.sm\:scale-100{--tw-scale-x:1;--tw-scale-y:1;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.sm\:flex-row{flex-direction:row}.sm\:flex-row-reverse{flex-direction:row-reverse}.sm\:items-end{align-items:flex-end}.sm\:items-center{align-items:center}.sm\:justify-end{justify-content:flex-end}.sm\:gap-4{gap:1rem}.sm\:gap-x-5{-moz-column-gap:1.25rem;column-gap:1.25rem}.sm\:space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem*var(--tw-space-x-reverse));margin-left:calc(1rem*calc(1 - var(--tw-space-x-reverse)))}.sm\:p-1{padding:.25rem}.sm\:px-2{padding-left:.5rem;padding-right:.5rem}.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}}.astro-route-announcer{clip:rect(0 0 0 0);clip-path:inset(50%);white-space:nowrap;width:1px;height:1px;position:absolute;top:0;left:0;overflow:hidden}#skip-to-content:where(.astro-3ef6ksr2){z-index:50;--tw-bg-opacity:1;background-color:rgba(var(--color-accent),var(--tw-bg-opacity));--tw-text-opacity:1;color:rgba(var(--color-fill),var(--tw-text-opacity));padding:.5rem .75rem;transition-property:all;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);position:absolute;top:-100%;left:4rem}#skip-to-content:where(.astro-3ef6ksr2):focus{top:1rem}.nav-container:where(.astro-3ef6ksr2){flex-direction:column;justify-content:space-between;align-items:center;max-width:48rem;margin-left:auto;margin-right:auto;display:flex}@media (min-width:640px){.nav-container:where(.astro-3ef6ksr2){flex-direction:row}}.top-nav-wrap:where(.astro-3ef6ksr2){justify-content:space-between;align-items:flex-start;width:100%;padding:1rem;display:flex;position:relative}@media (min-width:640px){.top-nav-wrap:where(.astro-3ef6ksr2){align-items:center;padding-top:2rem;padding-bottom:2rem}}.logo:where(.astro-3ef6ksr2){padding-top:.25rem;padding-bottom:.25rem;font-size:1.25rem;font-weight:600;line-height:1.75rem;position:absolute}@media (min-width:640px){.logo:where(.astro-3ef6ksr2){font-size:1.5rem;line-height:2rem;position:static}}.hamburger-menu:where(.astro-3ef6ksr2){align-self:flex-end;padding:.5rem}@media (min-width:640px){.hamburger-menu:where(.astro-3ef6ksr2){display:none}}.hamburger-menu:where(.astro-3ef6ksr2) svg:where(.astro-3ef6ksr2){--tw-scale-x:1.25;--tw-scale-y:1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y));fill:rgb(var(--color-text-base));width:1.5rem;height:1.5rem}nav:where(.astro-3ef6ksr2){flex-direction:column;align-items:center;width:100%;display:flex}@media (min-width:640px){nav:where(.astro-3ef6ksr2){flex-direction:row;justify-content:flex-end;margin-left:.5rem}nav:where(.astro-3ef6ksr2)>:not([hidden]):where(.astro-3ef6ksr2)~:not([hidden]):where(.astro-3ef6ksr2){--tw-space-x-reverse:0;margin-right:calc(1rem*var(--tw-space-x-reverse));margin-left:calc(1rem*calc(1 - var(--tw-space-x-reverse)))}nav:where(.astro-3ef6ksr2){padding-top:0;padding-bottom:0}}nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2){-moz-column-gap:.5rem;grid-template-rows:repeat(4,minmax(0,1fr));grid-template-columns:repeat(2,minmax(0,1fr));gap:.5rem;width:11rem;margin-top:1rem;display:grid}@media (min-width:640px){nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2){-moz-column-gap:1.25rem;gap:0 1.25rem;width:auto;margin-top:0;margin-left:0}}nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2){grid-column:span 2/span 2;justify-content:center;align-items:center;display:flex}nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2) a:where(.astro-3ef6ksr2){text-align:center;width:100%;padding:.75rem 1rem;font-weight:500}nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2) a:where(.astro-3ef6ksr2):hover{--tw-text-opacity:1;color:rgba(var(--color-accent),var(--tw-text-opacity))}@media (min-width:640px){nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2) a:where(.astro-3ef6ksr2){margin-top:0;margin-bottom:0;padding:.25rem .5rem}}nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2):nth-last-child(2) a:where(.astro-3ef6ksr2){width:auto}nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2):last-child,nav:where(.astro-3ef6ksr2) ul:where(.astro-3ef6ksr2) li:where(.astro-3ef6ksr2):nth-last-child(2){grid-column:span 1/span 1}nav:where(.astro-3ef6ksr2) a:where(.astro-3ef6ksr2).active{text-underline-offset:4px;text-decoration-line:underline;text-decoration-style:wavy;text-decoration-thickness:2px}nav:where(.astro-3ef6ksr2) a:where(.astro-3ef6ksr2).active svg:where(.astro-3ef6ksr2){fill:rgb(var(--color-accent))}nav:where(.astro-3ef6ksr2) button:where(.astro-3ef6ksr2){padding:.25rem}nav:where(.astro-3ef6ksr2) button:where(.astro-3ef6ksr2) svg:where(.astro-3ef6ksr2){fill:rgb(var(--color-text-base));width:1.5rem;height:1.5rem}nav:where(.astro-3ef6ksr2) button:where(.astro-3ef6ksr2) svg:where(.astro-3ef6ksr2):hover{fill:rgb(var(--color-accent))}#theme-btn:where(.astro-3ef6ksr2){padding:.75rem}@media (min-width:640px){#theme-btn:where(.astro-3ef6ksr2){padding:.25rem}}#theme-btn:where(.astro-3ef6ksr2) svg:where(.astro-3ef6ksr2){--tw-scale-x:1.25;--tw-scale-y:1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}#theme-btn:where(.astro-3ef6ksr2) svg:where(.astro-3ef6ksr2):hover{--tw-rotate:12deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}@media (min-width:640px){#theme-btn:where(.astro-3ef6ksr2) svg:where(.astro-3ef6ksr2){--tw-scale-x:1;--tw-scale-y:1;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}}.menu-icon:where(.astro-3ef6ksr2) line:where(.astro-3ef6ksr2){transition-property:opacity;transition-duration:75ms;transition-timing-function:cubic-bezier(.4,0,.2,1)}.menu-icon:where(.astro-3ef6ksr2) .close:where(.astro-3ef6ksr2),.menu-icon:where(.astro-3ef6ksr2).is-active .line:where(.astro-3ef6ksr2){opacity:0}.menu-icon:where(.astro-3ef6ksr2).is-active .close:where(.astro-3ef6ksr2){opacity:1}.social-icons:where(.astro-upu6fzxr){flex-wrap:wrap;justify-content:center;gap:.25rem}.link-button:where(.astro-upu6fzxr){padding:.5rem}.link-button:where(.astro-upu6fzxr):hover{--tw-rotate:6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}@media (min-width:640px){.link-button:where(.astro-upu6fzxr){padding:.25rem}}footer:where(.astro-sz7xmlte){width:100%}.footer-wrapper:where(.astro-sz7xmlte){flex-direction:column;justify-content:space-between;align-items:center;padding-top:1.5rem;padding-bottom:1.5rem;display:flex}@media (min-width:640px){.footer-wrapper:where(.astro-sz7xmlte){flex-direction:row-reverse;padding-top:1rem;padding-bottom:1rem}}.link-button:where(.astro-sz7xmlte){margin-top:.25rem;margin-bottom:.25rem;padding:.5rem}.link-button:where(.astro-sz7xmlte):hover{--tw-rotate:6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.link-button:where(.astro-sz7xmlte) svg:where(.astro-sz7xmlte){--tw-scale-x:1.25;--tw-scale-y:1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.copyright-wrapper:where(.astro-sz7xmlte){white-space:nowrap;flex-direction:column;align-items:center;margin-top:.5rem;margin-bottom:.5rem;display:flex}@media (min-width:640px){.copyright-wrapper:where(.astro-sz7xmlte){flex-direction:row}}.separator:where(.astro-sz7xmlte){display:none}@media (min-width:640px){.separator:where(.astro-sz7xmlte){display:inline}}#main-content:where(.astro-hsp6otuf){width:100%;max-width:48rem;margin-left:auto;margin-right:auto;padding-bottom:1rem;padding-left:1rem;padding-right:1rem}#main-content:where(.astro-hsp6otuf) h1:where(.astro-hsp6otuf){font-size:1.5rem;font-weight:600;line-height:2rem}@media (min-width:640px){#main-content:where(.astro-hsp6otuf) h1:where(.astro-hsp6otuf){font-size:1.875rem;line-height:2.25rem}}#main-content:where(.astro-hsp6otuf) p:where(.astro-hsp6otuf){margin-top:.5rem;margin-bottom:1.5rem;font-style:italic}.breadcrumb:where(.astro-ilhxcym7){width:100%;max-width:48rem;margin:2rem auto .25rem;padding-left:1rem;padding-right:1rem}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7){display:inline}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7) a:where(.astro-ilhxcym7){text-transform:capitalize;opacity:.7}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7) span:where(.astro-ilhxcym7){opacity:.7}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7):not(:last-child) a:where(.astro-ilhxcym7):hover{opacity:1}a:where(.astro-blwjyjpt){text-decoration-line:underline;text-decoration-style:dashed;position:relative}a:where(.astro-blwjyjpt):hover{--tw-text-opacity:1;color:rgba(var(--color-accent),var(--tw-text-opacity));top:-.125rem}a:where(.astro-blwjyjpt):focus-visible{padding:.25rem}a:where(.astro-blwjyjpt) svg:where(.astro-blwjyjpt){--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y));--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity));opacity:.8;width:1.5rem;height:1.5rem;margin-right:-1.25rem}.group:where(.astro-blwjyjpt):hover a:where(.astro-blwjyjpt) svg:where(.astro-blwjyjpt){fill:rgb(var(--color-accent))}@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*){animation:none!important}::view-transition-old(*){animation:none!important}::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}.pagination-wrapper:where(.astro-d776pwuy){justify-content:center;margin-top:auto;margin-bottom:2rem;display:flex}.disabled:where(.astro-d776pwuy){pointer-events:none;-webkit-user-select:none;user-select:none;opacity:.5}.disabled:where(.astro-d776pwuy):hover{--tw-text-opacity:1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.group:where(.astro-d776pwuy):hover .disabled:where(.astro-d776pwuy){fill:rgb(var(--color-text-base))}.group:where(.astro-d776pwuy):hover .disabled-svg:where(.astro-d776pwuy){fill:rgb(var(--color-text-base))!important}.social-icons:where(.astro-wkojbtzc){flex-flow:column wrap;justify-content:center;align-items:center;gap:.25rem;display:flex}@media (min-width:640px){.social-icons:where(.astro-wkojbtzc){align-items:flex-start}}.link-button:where(.astro-wkojbtzc){--tw-scale-x:.9;--tw-scale-y:.9;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y));padding:.5rem}.link-button:where(.astro-wkojbtzc):hover{--tw-rotate:6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skew(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}@media (min-width:640px){.link-button:where(.astro-wkojbtzc){padding:.25rem}}main:where(.astro-vj4tpspi){width:100%;max-width:48rem;margin-left:auto;margin-right:auto;padding-bottom:3rem;padding-left:1rem;padding-right:1rem}.post-title:where(.astro-vj4tpspi){--tw-text-opacity:1;color:rgba(var(--color-accent),var(--tw-text-opacity));font-size:1.5rem;font-weight:600;line-height:2rem}</style><script type="module" src="/astro/static/hoisted.sO-65EBM.js"></script><style>[data-astro-transition-scope=astro-plk3gbjq-1]{view-transition-name:spring}@layer astro{::view-transition-old(spring){animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}::view-transition-new(spring){animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back]::view-transition-old(spring){animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back]::view-transition-new(spring){animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-plk3gbjq-1],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-plk3gbjq-1]{animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-plk3gbjq-1],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-plk3gbjq-1]{animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-plk3gbjq-1],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-plk3gbjq-1]{animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-plk3gbjq-1],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-plk3gbjq-1]{animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}</style><style>[data-astro-transition-scope=astro-36ssibgs-2]{view-transition-name:java}@layer astro{::view-transition-old(java){animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}::view-transition-new(java){animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back]::view-transition-old(java){animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back]::view-transition-new(java){animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-36ssibgs-2],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-36ssibgs-2]{animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-36ssibgs-2],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-36ssibgs-2]{animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-36ssibgs-2],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-36ssibgs-2]{animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-36ssibgs-2],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-36ssibgs-2]{animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}</style><style>[data-astro-transition-scope=astro-36ssibgs-3]{view-transition-name:spring}@layer astro{::view-transition-old(spring){animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}::view-transition-new(spring){animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back]::view-transition-old(spring){animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back]::view-transition-new(spring){animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-36ssibgs-3],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-36ssibgs-3]{animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-36ssibgs-3],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-36ssibgs-3]{animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-36ssibgs-3],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-36ssibgs-3]{animation-name:astroFadeOut;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-36ssibgs-3],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-36ssibgs-3]{animation-name:astroFadeIn;animation-duration:.18s;animation-timing-function:cubic-bezier(.76,0,.24,1);animation-fill-mode:both}</style></head> <body>  <header class="astro-3ef6ksr2"> <a id="skip-to-content" href="#main-content" class="astro-3ef6ksr2">Skip to content</a> <div class="astro-3ef6ksr2 nav-container"> <div class="astro-3ef6ksr2 top-nav-wrap"> <a href="/astro" class="astro-3ef6ksr2 logo whitespace-nowrap"> 知道的越多，才知知道的越少 </a> <nav id="nav-menu" class="astro-3ef6ksr2"> <button class="astro-3ef6ksr2 focus-outline hamburger-menu" aria-label="Open Menu" aria-expanded="false" aria-controls="menu-items"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="astro-3ef6ksr2 menu-icon"> <line x1="7" y1="12" x2="21" y2="12" class="line astro-3ef6ksr2"></line> <line x1="3" y1="6" x2="21" y2="6" class="line astro-3ef6ksr2"></line> <line x1="12" y1="18" x2="21" y2="18" class="line astro-3ef6ksr2"></line> <line x1="18" y1="6" x2="6" y2="18" class="astro-3ef6ksr2 close"></line> <line x1="6" y1="6" x2="18" y2="18" class="astro-3ef6ksr2 close"></line> </svg> </button> <ul id="menu-items" class="astro-3ef6ksr2 display-none sm:flex"> <li class="astro-3ef6ksr2"> <a href="/astro/posts/" class="astro-3ef6ksr2">
Posts
</a> </li> <li class="astro-3ef6ksr2"> <a href="/astro/tags/" class="astro-3ef6ksr2">
Tags
</a> </li> <!-- <li>
            <a href="/about/" class={activeNav === "about" ? "active" : ""}>
              About
            </a>
          </li> --> <li class="astro-3ef6ksr2"> <a href="/astro/search/" class="astro-3ef6ksr2 focus-outline flex group hover:text-skin-accent inline-block p-3 sm:p-1" aria-label="search" title="Search"> <svg xmlns="http://www.w3.org/2000/svg" class="astro-3ef6ksr2 scale-125 sm:scale-100"><path d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z" class="astro-3ef6ksr2"></path> </svg> <span class="astro-3ef6ksr2 sr-only">Search</span> </a> </li>  </ul> </nav> </div> </div> <div class="max-w-3xl mx-auto px-4"> <hr class="border-skin-line" aria-hidden="true"> </div> </header>   <div class="astro-vj4tpspi flex justify-start max-w-3xl mx-auto px-2 w-full"> <button class="astro-vj4tpspi flex focus-outline hover:opacity-75 mb-2 mt-8" onclick='history.length===1?window.location="/":history.back();
'> <svg xmlns="http://www.w3.org/2000/svg" class="astro-vj4tpspi"><path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" class="astro-vj4tpspi"></path> </svg><span class="astro-vj4tpspi">Go back</span> </button> </div> <main id="main-content" class="astro-vj4tpspi"> <h1 class="astro-vj4tpspi post-title" data-astro-transition-scope="astro-plk3gbjq-1">Spring</h1> <div class="astro-vj4tpspi flex items-center my-2 opacity-80 space-x-2"><svg xmlns="http://www.w3.org/2000/svg" class="inline-block fill-skin-base h-6 min-w-[1.375rem] scale-100 w-6" aria-hidden="true"><path d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"></path><path d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zM19 8l.001 12H5V8h14z"></path></svg><span class="italic text-base">Updated:</span><span class="italic text-base"><time datetime="2024-05-16T14:00:41.000Z">May 16, 2024</time><span aria-hidden="true"> | </span><span class="sr-only">&nbsp;at&nbsp;</span><span class="text-nowrap">02:00 PM</span></span></div> <article id="article" role="article" class="astro-vj4tpspi max-w-3xl mx-auto mt-8 prose"> <h2 id="table-of-contents">Table of contents</h2>
<p></p><details><summary>Open Table of contents</summary><p></p>
<ul>
<li><a href="#%E5%B8%B8%E8%A7%81%E5%BC%82%E5%B8%B8">常见异常</a></li>
<li><a href="#lambda">lambda</a></li>
<li><a href="#%E6%AD%A3%E5%88%99">正则</a></li>
<li><a href="#spring-boot">Spring boot</a>
<ul>
<li><a href="#java--jar-%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88">java -jar 做了什么</a></li>
<li><a href="#jarlauncher%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B">JarLauncher的执行流程</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E5%8C%85common">使用依赖包common</a></li>
<li><a href="#jar%E5%90%AF%E5%8A%A8%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8">jar启动器的作用</a></li>
</ul>
</li>
<li><a href="#spring-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE">Spring 自动配置</a>
<ul>
<li><a href="#conditional">@Conditional</a></li>
<li><a href="#conditionalonproperty">@ConditionalOnProperty</a></li>
<li><a href="#componentscan">@ComponentScan</a></li>
<li><a href="#import--configuration">@Import &amp; @Configuration</a>
<ul>
<li><a href="#configuration">@Configuration</a>
<ul>
<li><a href="#full--lite">FULL &amp; LITE</a></li>
</ul>
</li>
<li><a href="#import">@Import</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%B1%BB">配置类</a>
<ul>
<li><a href="#importselector">ImportSelector</a></li>
<li><a href="#deferredimportselector">DeferredImportSelector</a></li>
<li><a href="#importbeandefinitionregistrar">ImportBeanDefinitionRegistrar</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D">Spring 自动装配</a>
<ul>
<li><a href="#spring%E6%B3%A8%E8%A7%A3%E5%8F%91%E5%B1%95%E8%BF%87%E7%A8%8B">Spring注解发展过程</a></li>
<li><a href="#springboot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86">SpringBoot自动装配原理</a></li>
<li><a href="#%E4%BD%95%E6%97%B6%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D">何时进行自动装配</a></li>
<li><a href="#run-%E6%96%B9%E6%B3%95">run 方法</a></li>
</ul>
</li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-starter">什么是 Starter</a></li>
<li><a href="#maven-%E4%B8%AD%E7%9A%84%E5%8F%AF%E9%80%89%E4%BE%9D%E8%B5%96">Maven 中的可选依赖</a></li>
<li><a href="#spring-%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8">Spring 中的注解处理器</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A3%85%E6%8D%A2%E5%99%A8">自定义装换器</a>
<ul>
<li><a href="#webmvcconfigurationadapter">WebMvcConfigurationAdapter</a></li>
<li><a href="#webmvcconfigurationsupport">WebMvcConfigurationSupport</a></li>
<li><a href="#webmvcautoconfiguration">WebMvcAutoConfiguration</a></li>
<li><a href="#webmvcconfigurer">WebMvcConfigurer</a></li>
<li><a href="#enablewebmvc">@EnableWebMVC</a>
<ul>
<li><a href="#%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">失效问题解决</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#junit">junit</a></li>
</ul>
</li>
<li><a href="#%E7%96%91%E9%97%AE">疑问</a></li>
</ul>
<p></p></details><p></p>
<h2 id="常见异常">常见异常</h2>









































































































































<table><thead><tr><th>异常</th><th>描述</th></tr></thead><tbody><tr><td>ClassCastException</td><td>类型强制转换异常</td></tr><tr><td>NegativeArrayException</td><td>数组负下标异常</td></tr><tr><td>ArrayIndexOutOfBoundsException</td><td>数组下标越界异常</td></tr><tr><td>SecturityException</td><td>违背安全原则异常</td></tr><tr><td>EOFException</td><td>文件已结束异常</td></tr><tr><td>FileNotFoundException</td><td>文件未找到异常</td></tr><tr><td>NumberFormatException</td><td>字符串转换为数字异常</td></tr><tr><td>SQLException</td><td>操作数据库异常</td></tr><tr><td>IOException</td><td>输入输出异常</td></tr><tr><td>NoSuchMethodException</td><td>方法未找到异常</td></tr><tr><td>Java.lang.AbstractMethodError</td><td>抽象方法错误。当应用试图调用抽象方法时抛出。</td></tr><tr><td>java.lang.AssertionError</td><td>断言错。用来指示一个断言失败的情况。</td></tr><tr><td>java.lang.ClassCircularityError</td><td>类循环依赖错误。在初始化一个类时，若检测到类之间循环依赖则抛出该异常。</td></tr><tr><td>java.lang.ClassFormatError</td><td>类格式错误。当Java虚拟机试图从一个文件中读取Java类，而检测到该文件的内容不符合类的有效格式时抛出。</td></tr><tr><td>java.lang.Error</td><td>错误。是所有错误的基类，用于标识严重的程序运行问题。这些问题通常描述一些不应被应用程序捕获的反常情况。</td></tr><tr><td>java.lang.ExceptionInInitializerError</td><td>初始化程序错误。当执行一个类的静态初始化程序的过程中，发生了异常时抛出。静态初始化程序是指直接包含于类中的static语句段。</td></tr><tr><td>java.lang.IllegalAccessError</td><td>违法访问错误。当一个应用试图访问、修改某个类的域(Field)或者调用其方法，但是又违反域或方法的可见性声明，则抛出该异常。</td></tr><tr><td>java.lang.IncompatibleClassChangeError</td><td>不兼容的类变化错误。当正在执行的方法所依赖的类定义发生了不兼容的改变时，抛出该异常。一般在修改了应用中的某些类的声明定义而没有对整个应用重新编译而直接运行的情况下，容易引发该错误。</td></tr><tr><td>java.lang.InstantiationError</td><td>实例化错误。当一个应用试图通过Java的new操作符构造一个抽象类或者接口时抛出该异常.</td></tr><tr><td>java.lang.InternalError</td><td>内部错误。用于指示Java虚拟机发生了内部错误。</td></tr><tr><td>java.lang.LinkageError</td><td>链接错误。该错误及其所有子类指示某个类依赖于另外一些类，在该类编译之后，被依赖的类改变了其类定义而没有重新编译所有的类，进而引发错误的情况。</td></tr><tr><td>java.lang.NoClassDefFoundError</td><td>未找到类定义错误。当Java虚拟机或者类装载器试图实例化某个类，而找不到该类的定义时抛出该错误。</td></tr><tr><td>java.lang.NoSuchFieldError</td><td>域不存在错误。当应用试图访问或者修改某类的某个域，而该类的定义中没有该域的定义时抛出该错误。</td></tr><tr><td>java.lang.NoSuchMethodError</td><td>方法不存在错误。当应用试图调用某类的某个方法，而该类的定义中没有该方法的定义时抛出该错误。</td></tr><tr><td>java.lang.OutOfMemoryError</td><td>内存不足错误。当可用内存不足以让Java虚拟机分配给一个对象时抛出该错误。</td></tr><tr><td>java.lang.StackOverflowError</td><td>堆栈溢出错误。当一个应用递归调用的层次太深而导致堆栈溢出时抛出该错误。</td></tr><tr><td>java.lang.ThreadDeath</td><td>线程结束。当调用Thread类的stop方法时抛出该错误，用于指示线程结束。</td></tr><tr><td>java.lang.UnknownError</td><td>未知错误。用于指示Java虚拟机发生了未知严重错误的情况。</td></tr><tr><td>java.lang.UnsatisfiedLinkError</td><td>未满足的链接错误。当Java虚拟机未找到某个类的声明为native方法的本机语言定义时抛出。</td></tr><tr><td>java.lang.UnsupportedClassVersionError</td><td>不支持的类版本错误。当Java虚拟机试图从读取某个类文件，但是发现该文件的主、次版本号不被当前Java虚拟机支持的时候，抛出该错误。</td></tr><tr><td>java.lang.VerifyError</td><td>验证错误。当验证器检测到某个类文件中存在内部不兼容或者安全问题时抛出该错误。</td></tr><tr><td>java.lang.VirtualMachineError</td><td>虚拟机错误。用于指示虚拟机被破坏或者继续执行操作所需的资源不足的情况</td></tr></tbody></table>
<h2 id="lambda">lambda</h2>
<p>求两个对象 list 的交集</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">private</span><span style="color:#E5C07B"> List</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">People</span><span style="color:#56B6C2">&gt;</span><span style="color:#61AFEF"> sameList</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">List</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">People</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75"> oldArrayList</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> List</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">People</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75"> newArrayList) {</span></span>
<span class="line"><span style="color:#E5C07B">    List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">People</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> resultList </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> newArrayList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">            .</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(item </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> oldArrayList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(e </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getCode</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">                    .</span><span style="color:#61AFEF">collect</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Collectors</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">()).</span><span style="color:#61AFEF">contains</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">item</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getCode</span><span style="color:#ABB2BF">()))</span></span>
<span class="line"><span style="color:#ABB2BF">            .</span><span style="color:#61AFEF">collect</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Collectors</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#E06C75"> resultList</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<p>求两个对象 list 的差集</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">private</span><span style="color:#E5C07B"> List</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">People</span><span style="color:#56B6C2">&gt;</span><span style="color:#61AFEF"> diffList</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">List</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">People</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75"> firstArrayList</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> List</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">People</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75"> secondArrayList) {</span></span>
<span class="line"><span style="color:#E5C07B">        List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">People</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> resultList </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> firstArrayList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(item </span><span style="color:#C678DD">-&gt;</span><span style="color:#56B6C2"> !</span><span style="color:#E5C07B">secondArrayList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(e </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getCode</span><span style="color:#ABB2BF">()).</span><span style="color:#61AFEF">collect</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Collectors</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">()).</span><span style="color:#61AFEF">contains</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">item</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getCode</span><span style="color:#ABB2BF">()))</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">collect</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Collectors</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#E06C75"> resultList</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span></code></pre>
<p>list 去除另一个 list 重复元素的数据</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E5C07B">firstList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">removeIf</span><span style="color:#ABB2BF">(first </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> secondList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">anyMatch</span><span style="color:#ABB2BF">(second </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> first</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getCode</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">equals</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">second</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getCode</span><span style="color:#ABB2BF">())));</span></span>
<span class="line"></span></code></pre>
<h2 id="正则">正则</h2>
<p>(?!0(.0+)?$) 使用负向前瞻，排除0、0.0、0.00等数字。</p>
<p>(?!0+(.\d+)?$) 使用负向前瞻，排除以0开头的数字，如0.123、0.001等。</p>
<p>\d+(.\d+)? 匹配正整数和小数，其中小数点后面至少有一位数字</p>
<h2 id="spring-boot">Spring boot</h2>
<p>为什么打成的jar包，通过java -jar xxx.jar 就能启动运行？</p>
<p>jar包里面含有一下三部分文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230404172555912.png" alt="image-20230404172555912" loading="lazy" decoding="async"></p>
<blockquote>
<p>org：主要存放springboot相关的class文件</p>
<p>META-INF：主要存放maven和MANIFEST.MF文件</p>
<p>BOOT-INF/classes：主要存放应用编译后的class文件</p>
<p>BOOT-INF/lib：主要存放应用依赖的jar包文件</p>
</blockquote>
<p>打开META-INF下MENIFEST.MF文件，内容如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230404172728434.png" alt="image-20230404172728434" loading="lazy" decoding="async"></p>
<p>从上述MANIFEST.MF中可以看到Main-Class及Start-Class配置，其中Main-Class指定jar文件的入口类JarLauncher，当使用java -jar执行jar包的时候会调用JarLauncher的main方法，而不是我们编写的启动类。</p>
<p>JarLauncher叫做jar包启动器，当我们运行java -jar 的时候就会找到这个启动器。</p>
<p>这个启动器是我们在打包的时候弄进去的，也就是我们在pom文件中加入的插件：</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">build</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">plugins</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">plugin</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">groupId</span><span style="color:#ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75">groupId</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">artifactId</span><span style="color:#ABB2BF">&gt;spring-boot-maven-plugin&lt;/</span><span style="color:#E06C75">artifactId</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">plugin</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">plugins</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">build</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span></code></pre>
<blockquote>
<p>注意：
只有添加了spring-boot-maven-plugin插件，运行mvn:package命令后打成的jar包才能直接运行。</p>
</blockquote>
<p>这个插件在打包时候就会把jar启动器添加进去。</p>
<h3 id="java--jar-做了什么">java -jar 做了什么</h3>
<blockquote>
<p>官网对java -jar的解释如下：</p>
<p>If the -jar option is specified, its argument is the name of the JAR file containing class and resource files for the application. The startup class must be indicated by the Main-Class manifest header in its source code.</p>
<p>如果指定了-jar选项，它的参数是包含应用程序的类和资源文件的JAR文件的名称。启动类必须由其源代码中的Main-Class清单头指明。</p>
</blockquote>
<p>由此可见：当使用java -jar 启动springboot jar包时是去找Manifast.MF文件中的Main-Class指定的类来启动项目。</p>
<h3 id="jarlauncher的执行流程">JarLauncher的执行流程</h3>
<blockquote>
<p>org.springframework.boot.loader.JarLauncher#main
org.springframework.boot.loader.Launcher#launch(java.lang.String[])
org.springframework.boot.loader.Launcher#launch(java.lang.String[], java.lang.String, java.lang.ClassLoader) 中的第二个参数mainClass-》org.springframework.boot.loader.ExecutableArchiveLauncher#getMainClass
org.springframework.boot.loader.Launcher#createMainMethodRunner
org.springframework.boot.loader.MainMethodRunner#run</p>
</blockquote>
<p>添加spring-boot-loader依赖，才可以查看源码</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">dependency</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">  &lt;</span><span style="color:#E06C75">groupId</span><span style="color:#ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75">groupId</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">  &lt;</span><span style="color:#E06C75">artifactId</span><span style="color:#ABB2BF">&gt;spring-boot-loader&lt;/</span><span style="color:#E06C75">artifactId</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">  &lt;</span><span style="color:#E06C75">version</span><span style="color:#ABB2BF">&gt;2.1.16.RELEASE&lt;/</span><span style="color:#E06C75">version</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">dependency</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">package</span><span style="color:#C678DD"> org.springframework.boot.loader</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> org.springframework.boot.loader.archive.Archive</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * {@link Launcher} for JAR based archives. This launcher assumes that dependency jars are</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * included inside a {@code /BOOT-INF/lib} directory and that application classes are</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * included inside a {@code /BOOT-INF/classes} directory.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> *</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * {@link Launcher}用于基于JAR的档案。该启动程序假设依赖jar包含在{@code BOOT-INFlib}目录中，并且应用程序类包含在{@code BOOT-INFclasses}目录中。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> *</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Phillip Webb</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Andy Wilkinson</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@since</span><span style="color:#7F848E;font-style:italic"> 1.0.0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> JarLauncher</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> ExecutableArchiveLauncher</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  static</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75"> BOOT_INF_CLASSES </span><span style="color:#56B6C2">=</span><span style="color:#98C379"> "BOOT-INF/classes/"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  static</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75"> BOOT_INF_LIB </span><span style="color:#56B6C2">=</span><span style="color:#98C379"> "BOOT-INF/lib/"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#61AFEF"> JarLauncher</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  protected</span><span style="color:#61AFEF"> JarLauncher</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Archive</span><span style="color:#E06C75;font-style:italic"> archive</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    super</span><span style="color:#ABB2BF">(archive);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">  protected</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> isNestedArchive</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Archive</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Entry</span><span style="color:#E06C75;font-style:italic"> entry</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">entry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isDirectory</span><span style="color:#ABB2BF">()) {</span></span>
<span class="line"><span style="color:#C678DD">      return</span><span style="color:#E5C07B"> entry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getName</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">equals</span><span style="color:#ABB2BF">(BOOT_INF_CLASSES);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#E5C07B"> entry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getName</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">startsWith</span><span style="color:#ABB2BF">(BOOT_INF_LIB);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  //main方法入口， 构造JarLauncher，然后调用它的launch方法。参数是控制台传递的</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">[] </span><span style="color:#E06C75;font-style:italic">args</span><span style="color:#ABB2BF">)</span><span style="color:#C678DD"> throws</span><span style="color:#E5C07B"> Exception</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    new</span><span style="color:#61AFEF"> JarLauncher</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">launch</span><span style="color:#ABB2BF">(args);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p><strong>启动类基类</strong>：org.springframework.boot.loader.Launcher-》org.springframework.boot.loader.Launcher#launch(java.lang.String[])</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * Base class for launchers that can start an application with a fully configured</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * classpath backed by one or more {@link Archive}s.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * 启动器的基类，可以用一个或多个{@link Archive}支持的完整配置的类路径启动应用程序。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Phillip Webb</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Dave Syer</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@since</span><span style="color:#7F848E;font-style:italic"> 1.0.0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> abstract</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> Launcher</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * Launch the application. This method is the initial entry point that should be</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * called by a subclass {@code public static void main(String[] args)} method.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 启动应用程序。这个方法是一个初始入口点，它应该被子类{@code public static void main(String[] args)}方法调用。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> args</span><span style="color:#7F848E;font-style:italic"> the incoming arguments</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * </span><span style="color:#C678DD;font-style:italic">@throws</span><span style="color:#E5C07B;font-style:italic"> Exception</span><span style="color:#7F848E;font-style:italic"> if the application fails to launch</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#C678DD">  protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> launch</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">[] </span><span style="color:#E06C75;font-style:italic">args</span><span style="color:#ABB2BF">)</span><span style="color:#C678DD"> throws</span><span style="color:#E5C07B"> Exception</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //在系统属性中设置注册了自定义的URL处理器：org.springframework.boot.loader.jar.Handler。如果URL中没有指定处理器，会去系统属性中查询</span></span>
<span class="line"><span style="color:#E5C07B">    JarFile</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">registerUrlProtocolHandler</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // getClassPathArchives方法在会去找lib目录下对应的第三方依赖JarFileArchive，同时也会项目自身的JarFileArchive</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // 根据getClassPathArchives得到的JarFileArchive集合去创建类加载器ClassLoader。这里会构造一个LaunchedURLClassLoader类加载器，这个类加载器继承URLClassLoader，并使用这些JarFileArchive集合的URL构造成URLClassPath</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // LaunchedURLClassLoader类加载器的父类加载器是当前执行类JarLauncher的类加载器</span></span>
<span class="line"><span style="color:#E5C07B">    ClassLoader</span><span style="color:#E06C75"> classLoader</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> createClassLoader</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">getClassPathArchives</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // getMainClass方法会去项目自身的Archive中的Manifest中找出key为Start-Class的类</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 调用重载方法launch</span></span>
<span class="line"><span style="color:#61AFEF">    launch</span><span style="color:#ABB2BF">(args, </span><span style="color:#61AFEF">getMainClass</span><span style="color:#ABB2BF">(), classLoader);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">  ......</span></span>
<span class="line"><span style="color:#ABB2BF">  ......</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>可执行存档启动类的基类：org.springframework.boot.loader.ExecutableArchiveLauncher -》org.springframework.boot.loader.ExecutableArchiveLauncher#getMainClass</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * Base class for executable archive {@link Launcher}s.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * 可执行存档{@link启动器}的基类。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Phillip Webb</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Andy Wilkinson</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@since</span><span style="color:#7F848E;font-style:italic"> 1.0.0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> abstract</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> ExecutableArchiveLauncher</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> Launcher</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  private</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> Archive</span><span style="color:#E06C75"> archive</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#61AFEF"> ExecutableArchiveLauncher</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    try</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">      this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">archive</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> createArchive</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#C678DD">    catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">Exception</span><span style="color:#E06C75;font-style:italic"> ex</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD">      throw</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> IllegalStateException</span><span style="color:#ABB2BF">(ex);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  protected</span><span style="color:#61AFEF"> ExecutableArchiveLauncher</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Archive</span><span style="color:#E06C75;font-style:italic"> archive</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">archive</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> archive;</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  protected</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> Archive</span><span style="color:#61AFEF"> getArchive</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">archive</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">  protected</span><span style="color:#E5C07B"> String</span><span style="color:#61AFEF"> getMainClass</span><span style="color:#ABB2BF">()</span><span style="color:#C678DD"> throws</span><span style="color:#E5C07B"> Exception</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //跟代码this.archive.getManifest()发现对应的是org.springframework.boot.loader.archive.JarFileArchive#getManifest</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //继续跟进入org.springframework.boot.loader.jar.JarFile#getManifest</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //最后org.springframework.boot.loader.jar.JarFile#getManifest对应的是META-INF/MANIFEST.MF文件的内容</span></span>
<span class="line"><span style="color:#E5C07B">    Manifest</span><span style="color:#E06C75"> manifest</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">archive</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getManifest</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">    String</span><span style="color:#E06C75"> mainClass</span><span style="color:#56B6C2"> =</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (manifest </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">      //获取META-INF/MANIFEST.MF文件内容中的Start-Class，这才是我们自己写的启动类</span></span>
<span class="line"><span style="color:#ABB2BF">      mainClass </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> manifest</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMainAttributes</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getValue</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Start-Class"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (mainClass </span><span style="color:#56B6C2">==</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD">      throw</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> IllegalStateException</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"No 'Start-Class' manifest entry specified in "</span><span style="color:#56B6C2"> +</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#ABB2BF"> mainClass;</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">  ......</span></span>
<span class="line"><span style="color:#ABB2BF">  ......</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>到此可以看出org.springframework.boot.loader.Launcher#launch(java.lang.String[], java.lang.String, java.lang.ClassLoader)中的mainClass参数正是我们自己写的启动类，也就是META-INF/MANIFEST.MF文件中Start-Class指定的类。</p>
<p><strong>Launcher的launch方法</strong>：org.springframework.boot.loader.Launcher#launch(java.lang.String[], java.lang.String, java.lang.ClassLoader)</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * Launch the application given the archive file and a fully configured classloader.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * 启动应用程序，给出归档文件和一个完全配置的类加载器。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> args</span><span style="color:#7F848E;font-style:italic"> the incoming arguments</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> mainClass</span><span style="color:#7F848E;font-style:italic"> the main class to run</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> classLoader</span><span style="color:#7F848E;font-style:italic"> the classloader</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@throws</span><span style="color:#E5C07B;font-style:italic"> Exception</span><span style="color:#7F848E;font-style:italic"> if the launch fails</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> launch</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75">[] args</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75"> mainClass</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> ClassLoader</span><span style="color:#E06C75"> classLoader) throws Exception {</span></span>
<span class="line"><span style="color:#E5C07B">  Thread</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">currentThread</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setContextClassLoader</span><span style="color:#ABB2BF">(classLoader);</span></span>
<span class="line"><span style="color:#61AFEF">  createMainMethodRunner</span><span style="color:#E06C75">(mainClass</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> args</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> classLoader)</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">run</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<p><strong>createMainMethodRunner 方法</strong>：org.springframework.boot.loader.Launcher#createMainMethodRunner</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * Create the {@code MainMethodRunner} used to launch the application.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> mainClass</span><span style="color:#7F848E;font-style:italic"> the main class</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> args</span><span style="color:#7F848E;font-style:italic"> the incoming arguments</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> classLoader</span><span style="color:#7F848E;font-style:italic"> the classloader</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@return</span><span style="color:#7F848E;font-style:italic"> the main method runner</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">protected</span><span style="color:#E5C07B"> MainMethodRunner</span><span style="color:#61AFEF"> createMainMethodRunner</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75"> mainClass</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75">[] args</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> ClassLoader</span><span style="color:#E06C75"> classLoader) {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> MainMethodRunner</span><span style="color:#E06C75">(mainClass</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> args)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<p><strong>MainMethodRunner</strong>：org.springframework.boot.loader.MainMethodRunner-》org.springframework.boot.loader.MainMethodRunner#run</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * Utility class that is used by {@link Launcher}s to call a main method. The class</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * containing the main method is loaded using the thread context class loader.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * 被{@link Launcher}用来调用main方法的实用程序类。包含main方法的类是使用线程上下文类装入器装入的。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Phillip Webb</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@author</span><span style="color:#7F848E;font-style:italic"> Andy Wilkinson</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@since</span><span style="color:#7F848E;font-style:italic"> 1.0.0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainMethodRunner</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  private</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75"> mainClassName</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  private</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75">[] args</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * Create a new {@link MainMethodRunner} instance.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> mainClass</span><span style="color:#7F848E;font-style:italic"> the main class</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> args</span><span style="color:#7F848E;font-style:italic"> incoming arguments</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#61AFEF"> MainMethodRunner</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75;font-style:italic"> mainClass</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">[] </span><span style="color:#E06C75;font-style:italic">args</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">mainClassName</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> mainClass;</span></span>
<span class="line"><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">args</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (args </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">?</span><span style="color:#E5C07B"> args</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">clone</span><span style="color:#ABB2BF">() </span><span style="color:#C678DD">:</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> run</span><span style="color:#ABB2BF">()</span><span style="color:#C678DD"> throws</span><span style="color:#E5C07B"> Exception</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    Class</span><span style="color:#ABB2BF">&lt;</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">&gt; </span><span style="color:#E06C75">mainClass</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Thread</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">currentThread</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getContextClassLoader</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">loadClass</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">mainClassName</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">    Method</span><span style="color:#E06C75"> mainMethod</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> mainClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getDeclaredMethod</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"main"</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">[].</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">    mainMethod</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">invoke</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">new</span><span style="color:#E5C07B"> Object</span><span style="color:#ABB2BF">[] { </span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">args</span><span style="color:#ABB2BF"> });</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>上述关键代码执行流程简化如下图:</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281126515.png" alt="img" loading="lazy" decoding="async"></p>
<h4 id="使用依赖包common">使用依赖包common</h4>
<p>common 执行mvn install时，会报错提示 Unable to find a single main class。spring boot项目使用maven打包，如果没有做配置的话，会自动寻找签名是public static void main(String[] args)的方法。common 只是一个服务工程，本来就不会存在启动入口。</p>
<p>在common中添加过滤配置即可打包成功：</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">plugin</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">groupId</span><span style="color:#ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75">groupId</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">artifactId</span><span style="color:#ABB2BF">&gt;spring-boot-maven-plugin&lt;/</span><span style="color:#E06C75">artifactId</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">configuration</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">skip</span><span style="color:#ABB2BF">&gt;true&lt;/</span><span style="color:#E06C75">skip</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">configuration</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">plugin</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span></code></pre>
<h4 id="jar启动器的作用">jar启动器的作用</h4>
<p>当我们使用java -jar的时候 JarLauncher 会将BOOT-INF/classes下的类文件和BOOT-INF/lib下依赖的jar包加载到classpath下，最后调用META-INF下的MANIFEST.MF文件的Start-Class属性来完成应用程序的启动。</p>
<h3 id="spring-自动配置">Spring 自动配置</h3>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281405585.png" alt="image-20230823113954382" loading="lazy" decoding="async"></p>
<p>SpringBoot 自动配置，Auto-Configuration</p>
<ul>
<li>它是指基于你引入的依赖 jar 包，对 SpringBoot 应用进行自动配置</li>
<li>它是SpringBoot框架的“开箱即用”提供了基础支撑</li>
</ul>
<p>术语“配置类”，Configuration Class</p>
<ul>
<li>广义的“配置类”：被注解@Component 直接或间接修饰的某个类，即我们常说的 Spring 组件，其中包括了@Configuration 类</li>
<li>狭义的“配置类”：特指被注解 @Configuration 所修饰的某个类，又成为 @Configuration 类</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281126131.png" alt="image-20230822172218836" loading="lazy" decoding="async"></p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281127736.png" alt="image-20230822172402498" loading="lazy" decoding="async"></p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281127191.png" alt="image-20230822173011734" loading="lazy" decoding="async"></p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281128533.png" alt="image-20230823113418389" loading="lazy" decoding="async"></p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281131684.png" alt="image-20230823113448199" loading="lazy" decoding="async"></p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281128270.png" alt="image-20230823113602551" loading="lazy" decoding="async"></p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281128307.png" alt="image-20230823113646014" loading="lazy" decoding="async"></p>
<h4 id="conditional">@Conditional</h4>
<ul>
<li>它的作用是实现：只有在特定条件满足时，才会向 IOC 容器注册指定的组件</li>
<li>我们可以将 @Conditional 理解为某种 if 语句</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main//img/202402281128177.png" alt="image-20230823113909162" loading="lazy" decoding="async"></p>
<h4 id="conditionalonproperty">@ConditionalOnProperty</h4>
<p>该注解的作用是可以通过配置文件中的属性值来判定 configuration 是否被注入，这样就可以灵活的配置组件的启用。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">//</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// Source code recreated from a .class file by IntelliJ IDEA</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// (powered by FernFlower decompiler)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">//</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">package</span><span style="color:#C678DD"> org.springframework.boot.autoconfigure.condition</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.lang.annotation.Documented</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.lang.annotation.ElementType</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.lang.annotation.Retention</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.lang.annotation.RetentionPolicy</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.lang.annotation.Target</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> org.springframework.context.annotation.Conditional</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">({</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">METHOD</span><span style="color:#E06C75">})</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Conditional</span><span style="color:#E06C75">({</span><span style="color:#E5C07B">OnPropertyCondition</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">})</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> ConditionalOnProperty</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 该属性与下面的 name 属性不可同时使用，</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 当value所对应配置文件中的值为false时，注入不生效，不为fasle注入生效</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * value有多个值时，只要有一个值对应为false,则注入不成功</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">value</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 配置文件中key的前缀，可与value 或 name 组合使用</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#61AFEF"> prefix</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#98C379"> ""</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 与 value 作用一致</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">name</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 与value 或 name 组合使用，只有当value 或 name 对应的值与havingValue的值相同时，注入生效</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#61AFEF"> havingValue</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#98C379"> ""</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   * 该属性为true时，配置文件中缺少对应的value或name的对应的属性值，也会注入成功</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">   */</span></span>
<span class="line"><span style="color:#C678DD">  boolean</span><span style="color:#61AFEF"> matchIfMissing</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<p>配置文件</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#E06C75">cod</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">  test</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">false</span></span>
<span class="line"></span></code></pre>
<p>配置类</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Slf4j</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Component</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">EnableScheduling</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ConditionalOnProperty</span><span style="color:#E06C75">(</span><span style="color:#D19A66">name</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "cod.test"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> ConditionalOnPropertyTest</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Scheduled</span><span style="color:#E06C75">(</span><span style="color:#D19A66">cron</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "*/5 * * * * ?"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> test</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        log</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">info</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"定时器执行。。。。"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>启动服务之后，只要配置了 code.test 且不为 false，都是有效的。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">// 只要配置文件中 code.test 为 false，即使设置 matchIfMissing = true 也是无效的</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 若没有配置 code.test，则 matchIfMissing 为 true 执行，false 不执行</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ConditionalOnProperty</span><span style="color:#E06C75">(</span><span style="color:#D19A66">prefix</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "cod"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> name</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "test"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> matchIfMissing</span><span style="color:#56B6C2"> =</span><span style="color:#D19A66"> true</span><span style="color:#E06C75">)</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">// 配置 code.test=111，相等于 havingValue，则执行，不同，不执行，即使设置 matchIfMissing = true 也是无效的</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 若 code.test=false，havingValue=false，则认为相等，执行</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 若没有配置 code.test，则 matchIfMissing 为 true 执行，false 不执行</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ConditionalOnProperty</span><span style="color:#E06C75">(</span><span style="color:#D19A66">prefix</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "cod"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> name</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "test"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> havingValue</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "111"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">matchIfMissing</span><span style="color:#56B6C2"> =</span><span style="color:#D19A66"> true</span><span style="color:#E06C75">)</span></span>
<span class="line"></span></code></pre>
<p>有配置看value，没配置看matchIfMissing。</p>
<h4 id="componentscan">@ComponentScan</h4>
<p>@ComponentScan，来自 Spring 框架的一个注解</p>
<ul>
<li>对指定的 package 进行扫描，找到其中符合条件的类，默认是搜索被注解@Component 修饰的配置类</li>
<li>通过属性 basePackages 或 basePackageClasses，来指定要进行扫描的 package</li>
<li>如果未指定 package，则默认扫描当前 @ComponentScan 所修饰的类所在的 package</li>
</ul>
<h4 id="import--configuration">@Import &amp; @Configuration</h4>
<p>通常，<code>@Import</code> 和 <code>@Configuration</code> 共同使用，用于在容器中注册对应的 <strong>BeanDefinition</strong>。</p>
<h5 id="configuration">@Configuration</h5>
<p>被 <code>@Configuration</code> 标注的类，通常称为 <strong>配置类</strong>，但配置类，并不单单指标注了 <code>@Configuration</code> 的类</p>
<ul>
<li>标注了 @Configuration 的配置类，称为 FULL 配置类，在 FULL 配置类中注册的 组件类，会在 ConfigurationClassPostProcessor#postProcessBeanFactory 方法中被 ConfigurationClassEnhancer 代理，交由 容器 处理依赖关系</li>
<li>而对于没有标注 <code>@Configuration</code>，但是标注了 <code>@Import</code> <code>Component</code> <code>ComponentScan</code> <code>ImportResource</code> 或者含有被 <code>Bean</code> 注解标注方法的配置类，称为 <strong>LITE</strong> 配置类</li>
<li>对于 FULL配置类 和 LITE配置类，ConfigurationClassPostProcessor 会委托 ConfigurationClassParser 类解析处理对应的 Component @PropertySource @ComponentScan @Import @ImportResource 注解以及标注了 @Bean 的方法</li>
</ul>
<h6 id="full--lite">FULL &amp; LITE</h6>
<p><strong>FULL配置类</strong> &amp; <strong>LITE配置类</strong> 的区别，可以看以下示例体会</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> A</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#61AFEF"> A</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"...A"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> B</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#61AFEF"> B</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">A</span><span style="color:#E06C75;font-style:italic"> a</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"...B"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ComponentScan</span><span style="color:#E06C75">(</span><span style="color:#98C379">"com.xsn.configurationtest"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyConfigurationConfig</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Bean</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#E5C07B"> A</span><span style="color:#61AFEF"> a</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> A</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Bean</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#E5C07B"> B</span><span style="color:#61AFEF"> b</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> B</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">a</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B">  AnnotationConfigApplicationContext</span><span style="color:#E06C75"> ac </span><span style="color:#56B6C2">=</span></span>
<span class="line"><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> AnnotationConfigApplicationContext</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">  A</span><span style="color:#E06C75"> a </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> ac</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBean</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">A</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">  System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(a);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">  B</span><span style="color:#E06C75"> b </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> ac</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBean</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">B</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">  System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(b);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">结果：</span></span>
<span class="line"><span style="color:#E06C75">FULL配置类（加了 </span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span><span style="color:#E06C75">）：</span></span>
<span class="line"><span style="color:#ABB2BF">...</span><span style="color:#E5C07B">A</span></span>
<span class="line"><span style="color:#ABB2BF">...</span><span style="color:#E5C07B">B</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">LITE配置类（注释掉 </span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span><span style="color:#E06C75">）：</span></span>
<span class="line"><span style="color:#ABB2BF">...</span><span style="color:#E5C07B">A</span></span>
<span class="line"><span style="color:#ABB2BF">...</span><span style="color:#E5C07B">A</span></span>
<span class="line"><span style="color:#ABB2BF">...</span><span style="color:#E5C07B">B</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>可以看到在 <strong>FULL配置类</strong> 下，<strong>A</strong> 和 <strong>B</strong> 的 <strong>依赖关系</strong> 将由 <strong>容器</strong> 处理。</p>
<p>我们可以看到，没有 @Configuration 修饰的时候，A 被实例化了两次。</p>
<p>现在我们搞清楚了@Configuration主要是用来做什么的了吧，它就是为了能够让我们spring，比如所我们的springboot或者spring在写上这种@Bean注解的时候（利用Java Config注解来完成对spring环境开发的时候），保证bean的一个作用域，保证它（bean）的生命周期跟它的作用域，包括Scope，Scope就是我们讲的单例（singletion）和原型（prototype）。</p>
<p>正常来说，我们在 B 中实现了 A 就应该是实例化两次，为什么会出现添加了 @Configuration 只实例化一次的情况那？</p>
<p>那么它没有执行两遍只有一个原因，你们可以思考一下，当我们一个方法调用的时候它的预期结果跟你想的不一样，那么你觉得是什么导致的。说白了，就是这个方法被改变了，这个方法不再是原来的这个方法，。因为我们这个方法，它的结果是必然的，它必然会产生一个类，但是我们调用两次它只产生一个类。那就违背了它的必然结果，那就说明了这个代码已经被别人改了。那么被随改了，肯定是被spring改了。那么按照我们现在所学的知识当中，我们要去改变一个方法的行为，没有改源码，可以用什么实现？</p>
<p>在这里用的是cglib动态代理。</p>
<p>不添加 @Configuration</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B">    AnnotationConfigApplicationContext</span><span style="color:#E06C75"> ac </span><span style="color:#56B6C2">=</span></span>
<span class="line"><span style="color:#C678DD">        new</span><span style="color:#61AFEF"> AnnotationConfigApplicationContext</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    MyConfigurationConfig</span><span style="color:#E06C75"> myConfigurationConfig </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> ac</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBean</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">  System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(myConfigurationConfig);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">结果：</span></span>
<span class="line"><span style="color:#E06C75">  （注释掉 </span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span><span style="color:#E06C75">）</span></span>
<span class="line"><span style="color:#E5C07B">  xxx</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">2833cc44</span></span>
<span class="line"><span style="color:#E06C75">  （加了 </span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span><span style="color:#E06C75">）</span></span>
<span class="line"><span style="color:#E5C07B">  xxx</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MyConfigurationConfig$$EnhancerBySpringCGLIB$$e52e37ff</span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">588df31b</span></span>
<span class="line"></span></code></pre>
<p>当然这里，会有疑问既然加不加 @Configuration 都可以获取 bean，那为什么还要使用那？</p>
<p>别傻了，小伙子，这里只是一个特殊情况，我们自己手动注册实现的，AnnotationConfigApplicationContext 里面会执行 this.register(componentClasses)，正常情况，不添加 @Configuration，Spring 容器根本就不会扫描，怎么可能会获取到 bean 那。</p>
<h5 id="import">@Import</h5>
<ul>
<li>
<p>提供了一种显示地从其他地方加载配置类的方式，这样可以避免使用性能较差的组件扫描（Component Scan）</p>
</li>
<li>
<p>属性值</p>
<ul>
<li>
<p>@Import 的属性值可以是一个 配置类，此处的配置类，可以是一个 @Configuration 注解标注的配置类（FULL 配置类）、一个标注了 @Import Component ComponentScan ImportResource 或者含有被 Bean 注解标注的方法（LITE 配置类）、甚至一个普通类</p>
</li>
<li>
<p>一个实现了 <strong>ImportSelector</strong> 的类</p>
</li>
<li>
<p>一个实现了 <strong>ImportBeanDefinitionRegistrar</strong> 的类</p>
</li>
</ul>
</li>
</ul>
<p><code>@Import</code> 和 <code>@Configuration</code> 共同使用，用于在容器中注册对应的 <strong>BeanDefinition</strong></p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> Import</span><span style="color:#E06C75"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">  Class</span><span style="color:#56B6C2">&lt;</span><span style="color:#C678DD">?</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">value</span><span style="color:#E06C75">()</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<h5 id="配置类">配置类</h5>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> C</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#61AFEF"> C</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"...c"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ComponentScan</span><span style="color:#E06C75">(</span><span style="color:#98C379">"com.xsn.configurationtest"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyConfigurationConfig</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B">  AnnotationConfigApplicationContext</span><span style="color:#E06C75"> ac </span><span style="color:#56B6C2">=</span></span>
<span class="line"><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> AnnotationConfigApplicationContext</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">  C</span><span style="color:#E06C75"> c </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> ac</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBean</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">  System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(c);</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">结果：</span></span>
<span class="line"><span style="color:#E5C07B">com</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">xsn</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">configurationtest</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">71ba6d4e</span></span>
<span class="line"></span></code></pre>
<p>类 <strong>C</strong> 就是一个普通类，同样也可以 <strong>Import</strong> 一个配置类（<strong>FULL</strong> &amp; <strong>LITE</strong>），如下</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> ImportConfiguration</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ComponentScan</span><span style="color:#E06C75">(</span><span style="color:#98C379">"com.xsn.configurationtest"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ImportConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyConfigurationConfig</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B">  AnnotationConfigApplicationContext</span><span style="color:#E06C75"> ac </span><span style="color:#56B6C2">=</span></span>
<span class="line"><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> AnnotationConfigApplicationContext</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">  C</span><span style="color:#E06C75"> c </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> ac</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBean</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">  System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(c);</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">结果：</span></span>
<span class="line"><span style="color:#E5C07B">com</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">xsn</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">configurationtest</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">71ba6d4e</span></span>
<span class="line"></span></code></pre>
<h6 id="importselector">ImportSelector</h6>
<p>同样，<code>@Import</code> 注解可以 <strong>Import</strong> 一个 <strong>ImportSelector</strong> 的实现类</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> interface</span><span style="color:#E5C07B"> ImportSelector</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // 返回要 Import 的配置类名</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#61AFEF">[] selectImports</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> importingClassMetadata</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // 允许提供一个 Predicate 过滤 selectImports 方法对应的类</span></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Nullable</span></span>
<span class="line"><span style="color:#C678DD">  default</span><span style="color:#E5C07B"> Predicate</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">&gt;</span><span style="color:#61AFEF"> getExclusionFilter</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>类似于直接 Import 配置类，但是 ImportSelector 的实现类可以基于对应配置类的 AnnotationMetadata 属性进行 select，同时还可以实现各种 Aware 接口类似 EnvironmentAware BeanFactoryAware 等，持有对应的 Environment BeanFactory 来进行 select</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyImportSelector</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> ImportSelector</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#E5C07B"> String</span><span style="color:#61AFEF">[] selectImports</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> importingClassMetadata</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">    StandardAnnotationMetadata</span><span style="color:#ABB2BF"> standardAnnotationMetadata</span></span>
<span class="line"><span style="color:#56B6C2">        =</span><span style="color:#ABB2BF"> (StandardAnnotationMetadata) importingClassMetadata;</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> String</span><span style="color:#ABB2BF">[]{</span><span style="color:#98C379">"com.xsn.configurationtest.C"</span><span style="color:#ABB2BF">};</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#E5C07B"> Predicate</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">&gt;</span><span style="color:#61AFEF"> getExclusionFilter</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ComponentScan</span><span style="color:#E06C75">(</span><span style="color:#98C379">"com.xsn.configurationtest"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyImportSelector</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyConfigurationConfig</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B">  AnnotationConfigApplicationContext</span><span style="color:#E06C75"> ac </span><span style="color:#56B6C2">=</span></span>
<span class="line"><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> AnnotationConfigApplicationContext</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyConfigurationConfig</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">  C</span><span style="color:#E06C75"> c </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> ac</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBean</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">  System</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">out</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">println</span><span style="color:#ABB2BF">(c);</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">结果：</span></span>
<span class="line"><span style="color:#E5C07B">com</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">xsn</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">configurationtest</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">C</span><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">5ab956d7</span></span>
<span class="line"></span></code></pre>
<h6 id="deferredimportselector">DeferredImportSelector</h6>
<p><strong>DeferredImportSelector</strong> 继承了 <strong>ImportSelector</strong>，当 <strong>Import</strong> 的是一个 <strong>DeferredImportSelector</strong> 时，该 <strong>DeferredImportSelector</strong> 会在最后解析，主要用于有 <code>@Conditional</code> 注解的配置类</p>
<h6 id="importbeandefinitionregistrar">ImportBeanDefinitionRegistrar</h6>
<p>ImportBeanDefinitionRegistrar 通常和@Import注解配合使用，@Import注解将ImportBeanDefinitionRegistrar的实现类注入到@Import所属根类的ConfigurationClass属性中，在注册跟类的BeanDefinition时，会遍历调用其@Import的所有ImportBeanDefinitionRegistrar接口的 registerBeanDefinitions()方法。</p>
<p><strong>介绍:</strong></p>
<p>ImportBeanDefinitionRegistrar 是 Spring 对外提供的动态注册 BeanDefinition 的接口，并且 Spring 内部大多也用该接口动态注册 BeanDefinition。</p>
<blockquote>
<p>ImportBeanDefinitionRegistrar 接口的 Bean 不会直接注册到 IOC 容器，它的执行时机比较早，发生在 SpringBoot 启动流程的注册 BeanDefinition。</p>
<p>ImportBeanDefinitionRegistrar 接口提供了 registerBeanDefinitions(AnnotationMetadata, BeanDefinitionRegistry) 供子类重写：</p>
<ul>
<li>开发者可以直接调用 BeanDefinitionRegistry#registerBeanDefinition() 方法传入 BeanDefinitionName 和对应的 BeanDefinition 对象，直接往 Spring 临时容器（beanDefinitionMap）中注册。</li>
<li>所谓的 Spring 临时容器是指：在 Spring 解析类时会将所有符合注册要求的类放到一个临时容器中，后续执行完 BeanPostProcessor、initMessageSource、initApplicationEventMulticaster、
onRefresh 等操作之后，才会从临时容器中取出所有类，真正注入到 Spring 容器（singletonObjects）中。</li>
</ul>
</blockquote>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> interface</span><span style="color:#E5C07B"> ImportBeanDefinitionRegistrar</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // 基于 AnnotationMetadata BeanDefinitionRegistry 注册对应的 BeanDefinition</span></span>
<span class="line"><span style="color:#C678DD">  default</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> registerBeanDefinitions</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> importingClassMetadata</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">BeanDefinitionRegistry</span><span style="color:#E06C75;font-style:italic"> registry</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">      BeanNameGenerator</span><span style="color:#E06C75;font-style:italic"> importBeanNameGenerator</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">    registerBeanDefinitions</span><span style="color:#ABB2BF">(importingClassMetadata, registry);</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  default</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> registerBeanDefinitions</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> importingClassMetadata</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">BeanDefinitionRegistry</span><span style="color:#E06C75;font-style:italic"> registry</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p><strong>ImportBeanDefinitionRegistrar</strong> 也可以实现各种 <strong>Aware</strong> 接口类似 <strong>EnvironmentAware</strong> <strong>BeanFactoryAware</strong> 等，持有对应的 <strong>Environment</strong> <strong>BeanFactory</strong> 来进行 <code>register</code></p>
<p>我们使用 <strong>Spring AOP</strong> 时，在配置类上添加的 <code>@EnableAspectJAutoProxy</code> 注解</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">AspectJAutoProxyRegistrar</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> EnableAspectJAutoProxy</span></span>
<span class="line"></span></code></pre>
<p>它 Import 的 AspectJAutoProxyRegistrar 便是一个 ImportBeanDefinitionRegistrar，该类会帮我们注册一个 AnnotationAwareAspectJAutoProxyCreator 的 BeanDefinition，实现 AOP 代理</p>
<p><strong>ImportBeanDefinitionRegistrar在 SpringBoot 启动流程中的体现？</strong></p>
<ol>
<li>
<p>处理ImportBeanDefinitionRegistrar的入口</p>
<p>在 SpringBoot 启动流程中，通过 ConfigurationClassParser#doProcessConfigurationClass() 解析启动类的注解时，会做@Import注解的process操作，即进入到ConfigurationClassParser#processImports()方法。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Nullable</span></span>
<span class="line"><span style="color:#C678DD">protected</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> SourceClass</span><span style="color:#61AFEF"> doProcessConfigurationClass</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ConfigurationClass</span><span style="color:#E06C75"> configClass</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> SourceClass</span><span style="color:#E06C75"> sourceClass</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> Predicate</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">String</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75"> filter) throws IOException {</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">isAnnotated</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Component</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getName</span><span style="color:#ABB2BF">())</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">processMemberClasses</span><span style="color:#ABB2BF">(configClass, sourceClass, filter);</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Iterator</span><span style="color:#E06C75"> var4 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> AnnotationConfigUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">attributesForRepeatable</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">PropertySources</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">PropertySource</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">iterator</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    AnnotationAttributes</span><span style="color:#E06C75"> importResource</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    while</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">var4</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasNext</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75">        importResource </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (AnnotationAttributes)</span><span style="color:#E5C07B">var4</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">environment</span><span style="color:#C678DD"> instanceof</span><span style="color:#E06C75"> ConfigurableEnvironment) {</span></span>
<span class="line"><span style="color:#E5C07B">            this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">processPropertySource</span><span style="color:#ABB2BF">(importResource);</span></span>
<span class="line"><span style="color:#E06C75">        } </span><span style="color:#C678DD">else</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B">            this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">logger</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">info</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Ignoring @PropertySource annotation on ["</span><span style="color:#56B6C2"> +</span><span style="color:#E5C07B"> sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getClassName</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">+</span><span style="color:#98C379"> "]. Reason: Environment must implement ConfigurableEnvironment"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Set</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">AnnotationAttributes</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> componentScans </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> AnnotationConfigUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">attributesForRepeatable</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">ComponentScans</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">ComponentScan</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#E06C75"> (</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">componentScans</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isEmpty</span><span style="color:#ABB2BF">()</span><span style="color:#56B6C2"> &amp;&amp;</span><span style="color:#56B6C2"> !</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">conditionEvaluator</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">shouldSkip</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">ConfigurationPhase</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">REGISTER_BEAN</span><span style="color:#ABB2BF">)</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        Iterator</span><span style="color:#E06C75"> var14 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> componentScans</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">iterator</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        while</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">var14</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasNext</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">            AnnotationAttributes</span><span style="color:#E06C75"> componentScan </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (AnnotationAttributes)</span><span style="color:#E5C07B">var14</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">            Set</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">BeanDefinitionHolder</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> scannedBeanDefinitions </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">componentScanParser</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(componentScan, </span><span style="color:#E5C07B">sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getClassName</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B">            Iterator</span><span style="color:#E06C75"> var8 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> scannedBeanDefinitions</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">iterator</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            while</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">var8</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasNext</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">                BeanDefinitionHolder</span><span style="color:#E06C75"> holder </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (BeanDefinitionHolder)</span><span style="color:#E5C07B">var8</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">                BeanDefinition</span><span style="color:#E06C75"> bdCand </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> holder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBeanDefinition</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getOriginatingBeanDefinition</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#E06C75"> (bdCand </span><span style="color:#56B6C2">==</span><span style="color:#D19A66"> null</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75">                    bdCand </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> holder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBeanDefinition</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">ConfigurationClassUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">checkConfigurationClassCandidate</span><span style="color:#ABB2BF">(bdCand, </span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">metadataReaderFactory</span><span style="color:#ABB2BF">)</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">                    this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">bdCand</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBeanClassName</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">holder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBeanName</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75">                }</span></span>
<span class="line"><span style="color:#E06C75">            }</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">processImports</span><span style="color:#ABB2BF">(configClass, sourceClass, </span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getImports</span><span style="color:#ABB2BF">(sourceClass), filter, </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75">    importResource </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> AnnotationConfigUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">attributesFor</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">ImportResource</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#E06C75"> (importResource </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75">[] resources </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> importResource</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getStringArray</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"locations"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        Class</span><span style="color:#ABB2BF">&lt;</span><span style="color:#C678DD">?</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> BeanDefinitionReader</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> readerClass </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> importResource</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getClass</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reader"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75">[] var20 </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> resources</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">        int</span><span style="color:#E06C75"> var22 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> resources</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">length</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        for</span><span style="color:#E06C75">(</span><span style="color:#C678DD">int</span><span style="color:#E06C75"> var23 </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> 0</span><span style="color:#ABB2BF">;</span><span style="color:#E06C75"> var23 </span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75"> var22</span><span style="color:#ABB2BF">;</span><span style="color:#ABB2BF"> ++</span><span style="color:#E06C75">var23) {</span></span>
<span class="line"><span style="color:#E5C07B">            String</span><span style="color:#E06C75"> resource </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> var20[var23]</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">            String</span><span style="color:#E06C75"> resolvedResource </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">resolveRequiredPlaceholders</span><span style="color:#ABB2BF">(resource);</span></span>
<span class="line"><span style="color:#E5C07B">            configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addImportedResource</span><span style="color:#ABB2BF">(resolvedResource, readerClass);</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Set</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">MethodMetadata</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> beanMethods </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">retrieveBeanMethodMetadata</span><span style="color:#ABB2BF">(sourceClass);</span></span>
<span class="line"><span style="color:#E5C07B">    Iterator</span><span style="color:#E06C75"> var18 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> beanMethods</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">iterator</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    while</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">var18</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasNext</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        MethodMetadata</span><span style="color:#E06C75"> methodMetadata </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (MethodMetadata)</span><span style="color:#E5C07B">var18</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addBeanMethod</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> BeanMethod</span><span style="color:#ABB2BF">(methodMetadata, configClass));</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">processInterfaces</span><span style="color:#ABB2BF">(configClass, sourceClass);</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">hasSuperClass</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75"> superclass </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getSuperClassName</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#E06C75"> (superclass </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#56B6C2"> &amp;&amp;</span><span style="color:#56B6C2"> !</span><span style="color:#E5C07B">superclass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">startsWith</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"java"</span><span style="color:#ABB2BF">)</span><span style="color:#56B6C2"> &amp;&amp;</span><span style="color:#56B6C2"> !</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">knownSuperclasses</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">containsKey</span><span style="color:#ABB2BF">(superclass)</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">            this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">knownSuperclasses</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(superclass, configClass);</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#E5C07B"> sourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getSuperClass</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>将 ImportBeanDefinitionRegistrar 添加到所属 ConfigClass 的一个属性上
进入到 ConfigurationClassParser#processImports() 方法中，接着看processImports()方法针对ImportBeanDefinitionRegistrar接口的具体处理逻辑</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">candidate</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isAssignable</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">ImportBeanDefinitionRegistrar</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">)</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75">    candidateClass </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> candidate</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadClass</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">    ImportBeanDefinitionRegistrar</span><span style="color:#E06C75"> registrar </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (ImportBeanDefinitionRegistrar)</span><span style="color:#E5C07B">ParserStrategyUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">instantiateClass</span><span style="color:#ABB2BF">(candidateClass, </span><span style="color:#E5C07B">ImportBeanDefinitionRegistrar</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">environment</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">resourceLoader</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">registry</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">    configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addImportBeanDefinitionRegistrar</span><span style="color:#ABB2BF">(registrar, </span><span style="color:#E5C07B">currentSourceClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<p>processImports()方法中会判断如果一个类A实现了ImportBeanDefinitionRegistrar接口，会对类A做实例化，并将其存储到当前ConfigClass的一个属性（Map类型的变量importBeanDefinitionRegistrars）中，以便在注册ConfigurationClass到Spring容器时，拿出importBeanDefinitionRegistrars中的所有内容，执行每个ImportBeanDefinitionRegistrar的registerBeanDefinitions()方法。</p>
</li>
<li>
<p>执行 ImportBeanDefinitionRegistrar 接口方法的时机</p>
<p>解析完所有的candidates候选类之后，会进入到ConfigurationClassBeanDefinitionReader#loadBeanDefinitions(Set<configurationclass>)方法对所有的ConfigurationClass做条件装配、属性处理，然后将相应BeanDefinition注册到Spring中。
ConfigurationClassPostProcessor#processConfigBeanDefinitions</configurationclass></p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> processConfigBeanDefinitions</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">BeanDefinitionRegistry</span><span style="color:#E06C75"> registry) {</span></span>
<span class="line"><span style="color:#ABB2BF">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  do</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">      // 解析启动类中的所有 ConfigurationClass 或者说 BeanDefinition</span></span>
<span class="line"><span style="color:#E5C07B">      parser</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(candidates);</span></span>
<span class="line"><span style="color:#E5C07B">      parser</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">validate</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">      Set</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">ConfigurationClass</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> configClasses </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> LinkedHashSet</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">parser</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getConfigurationClasses</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">      configClasses</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">removeAll</span><span style="color:#ABB2BF">(alreadyParsed);</span></span>
<span class="line"><span style="color:#C678DD">      if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">reader</span><span style="color:#56B6C2"> ==</span><span style="color:#D19A66"> null</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">          this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">reader</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> ConfigurationClassBeanDefinitionReader</span><span style="color:#E06C75">(registry</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">sourceExtractor</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">resourceLoader</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">environment</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">importBeanNameGenerator</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> parser</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getImportRegistry</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">      }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">      // 真正加载所有的 ConfigurationClass</span></span>
<span class="line"><span style="color:#E5C07B">      this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">reader</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadBeanDefinitions</span><span style="color:#ABB2BF">(configClasses);</span></span>
<span class="line"><span style="color:#E5C07B">      alreadyParsed</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addAll</span><span style="color:#ABB2BF">(configClasses);</span></span>
<span class="line"><span style="color:#E5C07B">      candidates</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">clear</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">      ...</span></span>
<span class="line"><span style="color:#E06C75">  } </span><span style="color:#C678DD">while</span><span style="color:#E06C75">(</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">candidates</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isEmpty</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> loadBeanDefinitions</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">Set</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">ConfigurationClass</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75"> configurationModel) {</span></span>
<span class="line"><span style="color:#E5C07B">    TrackedConditionEvaluator</span><span style="color:#E06C75"> trackedConditionEvaluator </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> TrackedConditionEvaluator</span><span style="color:#E06C75">()</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">    Iterator</span><span style="color:#E06C75"> var3 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> configurationModel</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">iterator</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    while</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">var3</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasNext</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        ConfigurationClass</span><span style="color:#E06C75"> configClass </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (ConfigurationClass)</span><span style="color:#E5C07B">var3</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadBeanDefinitionsForConfigurationClass</span><span style="color:#ABB2BF">(configClass, trackedConditionEvaluator);</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">private</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> loadBeanDefinitionsForConfigurationClass</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ConfigurationClass</span><span style="color:#E06C75"> configClass</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> TrackedConditionEvaluator</span><span style="color:#E06C75"> trackedConditionEvaluator) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 类注册阶段的条件装配</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">trackedConditionEvaluator</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">shouldSkip</span><span style="color:#ABB2BF">(configClass)</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75"> beanName </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBeanName</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">StringUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasLength</span><span style="color:#ABB2BF">(beanName)</span><span style="color:#56B6C2"> &amp;&amp;</span><span style="color:#E5C07B"> this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">registry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">containsBeanDefinition</span><span style="color:#ABB2BF">(beanName)</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">            this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">registry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">removeBeanDefinition</span><span style="color:#ABB2BF">(beanName);</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">importRegistry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">removeImportingClass</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getMetadata</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getClassName</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75">    } </span><span style="color:#C678DD">else</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isImported</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">            this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">registerBeanDefinitionForImportedConfigurationClass</span><span style="color:#ABB2BF">(configClass);</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        Iterator</span><span style="color:#E06C75"> var3 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBeanMethods</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">iterator</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // 处理 @Bean 方法</span></span>
<span class="line"><span style="color:#C678DD">        while</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">var3</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">hasNext</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">            BeanMethod</span><span style="color:#E06C75"> beanMethod </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (BeanMethod)</span><span style="color:#E5C07B">var3</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">            this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadBeanDefinitionsForBeanMethod</span><span style="color:#ABB2BF">(beanMethod);</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadBeanDefinitionsFromImportedResources</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getImportedResources</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // 执行 @Import 导入的 ImportBeanDefinitionRegistrar 接口方法</span></span>
<span class="line"><span style="color:#E5C07B">        this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadBeanDefinitionsFromRegistrars</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">configClass</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getImportBeanDefinitionRegistrars</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<blockquote>
<p>在加载并注册启动类的BeanDefinition时，会将启动类ConfigurationClass下的一些属性进行解析处理，其中就包括对@Import的所有ImportBeanDefinitionRegistrar接口方法进行执行。</p>
</blockquote>
</li>
</ol>
<h3 id="spring-自动装配">Spring 自动装配</h3>
<p>自动配置：Auto-Configuration</p>
<p>自动装配：Autowire</p>
<p>这是两个不同的东西。</p>
<h4 id="spring注解发展过程">Spring注解发展过程</h4>
<p>SpringBoot的自动装配依赖于注解，所以我们先来看一下注解的发展过程。</p>
<p>以下主要对核心注解进行说明</p>
<ul>
<li>
<p><strong>Spring1.0</strong>：刚刚出现注解。</p>
<ul>
<li>@Transaction：简化了事务的操作</li>
</ul>
</li>
<li>
<p><strong>Spring2.0</strong>：一些配置开始被 xml 代替，但是还不能完全摆脱xml，主要是component-scan标签。</p>
<ul>
<li>@Required：用在set方法上，如果加上该注解，表示在xml中必须设置属性的值，不然就会报错。</li>
<li>@Aspect ：AOP相关的一个注解，用来标识配置类。</li>
<li>@Autowired，@Qualifier：依赖注入</li>
<li>@Component，@Service，@Controller，@Repository：主要是声明一些bean对象放入IOC中。</li>
<li>@RequestMapping： 声明请求对应的处理方法</li>
</ul>
</li>
<li>
<p><strong>Spring3.0</strong>：已经完全可以用注解代替xml文件了</p>
<ul>
<li>
<p>@Configuration：配置类，代理xml配置文件</p>
</li>
<li>
<p>@ComponentScan：扫描其他注解，代理xml中的component-scan标签。</p>
</li>
<li>
<p>@Import：只能用在类上，主要是用来加载第三方的类。</p>
<ul>
<li>
<p>@import(value = {XXX.class})：加载一个普通的类</p>
</li>
<li>
<p>@Import(MyImportSelector.class)：这种主要是根据业务选择性加载一些类。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyImportSelector</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> ImportSelector</span><span style="color:#ABB2BF"> {</span><span style="color:#7F848E;font-style:italic">//继承该接口</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span><span style="color:#7F848E;font-style:italic">　　//重写selectImports方法</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#E5C07B"> String</span><span style="color:#61AFEF">[] selectImports</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> importingClassMetadata</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //返回对象对应的类型的全类路径的字符串数组</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> String</span><span style="color:#ABB2BF">[]{</span><span style="color:#E5C07B">XXX1</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getName</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">XXX2</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getName</span><span style="color:#ABB2BF">()};</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>@Import(MyImportBeanDefinitionRegistrar.class)：跟上面一样，都是根据业务选择性的加载一些类。只是返回的内容不一样，上面是直接返回选择的类的全路径，这个是将加载的类注册到一个BeanDefinitionRegistry中返回。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyImportBeanDefinitionRegistrar</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> ImportBeanDefinitionRegistrar</span><span style="color:#ABB2BF"> {</span><span style="color:#7F848E;font-style:italic">//继承该接口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span><span style="color:#7F848E;font-style:italic">   //重写registerBeanDefinitions方法</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> registerBeanDefinitions</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> importingClassMetadata</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">BeanDefinitionRegistry</span><span style="color:#E06C75;font-style:italic"> registry</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">         // 将需要注册的对象封装为 RootBeanDefinition 对象</span></span>
<span class="line"><span style="color:#E5C07B">        RootBeanDefinition</span><span style="color:#E06C75"> xxx1</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> RootBeanDefinition</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">XXX1</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        registry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">registerBeanDefinition</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"xxx1"</span><span style="color:#ABB2BF">, xxx1);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //再注册一个</span></span>
<span class="line"><span style="color:#E5C07B">        RootBeanDefinition</span><span style="color:#E06C75"> xxx2</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> RootBeanDefinition</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">XXX2</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        registry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">registerBeanDefinition</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"xxx2"</span><span style="color:#ABB2BF">, xxx2);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Spring4.0</strong>：</p>
<ul>
<li>
<p>@Conditional：按照一定的条件进行判断，满足条件就给容器注册Bean实例。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * 定义一个 Condition 接口的是实现</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyCondition</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> Condition</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> matches</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">ConditionContext</span><span style="color:#E06C75;font-style:italic"> context</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">AnnotatedTypeMetadata</span><span style="color:#E06C75;font-style:italic"> metadata</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //业务逻辑...</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// 默认返回false</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#7F848E;font-style:italic">//使用</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> JavaConfig</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Bean</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 条件注解，添加的类型必须是 实现了 Condition 接口的类型</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // MyCondition的 matches 方法返回true 则注入，返回false 则不注入</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Conditional</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">MyCondition</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#E5C07B"> StudentService</span><span style="color:#61AFEF"> studentService</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> StudentService</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
</li>
</ul>
</li>
<li>
<p><strong>Spring5.0</strong>:</p>
<ul>
<li>@Indexed：在Spring Boot应用场景中，大量使用@ComponentScan扫描，导致Spring模式的注解解析时间耗时增大，因此，5.0时代引入@Indexed，为Spring模式注解添加索引。
<ul>
<li>当我们在项目中使用了 @Indexed 之后，编译打包的时候会在项目中自动生成METAINT/spring.components文件。根据该文件进行扫描注入，可以提高效率。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="springboot自动装配原理">SpringBoot自动装配原理</h4>
<p>自动装配还是利用了SpringFactoriesLoader来加载META-INF/spring.factoires文件里所有配置的EnableAutoConfgruation，它会经过exclude和filter等操作，最终确定要装配的类。</p>
<p>一切的开始都源于@SpringBootApplication，它是一个组合注解</p>
<p>除了元注解之外，关注这三个注解：</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">SpringBootConfiguration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">EnableAutoConfiguration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ComponentScan</span></span>
<span class="line"></span></code></pre>
<ul>
<li>@SpringBootConfiguration该注解的作用是用来指定扫描路径的，如果不指定特定的扫描路径的话，扫描的路径是当前修饰的类所在的包及其子包。</li>
<li>@SpringBootConfiguration这个注解的本质其实是@Configuration注解。</li>
</ul>
<p>看来这个@EnableAutoConfiguration不简单</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">AutoConfigurationImportSelector</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"></span></code></pre>
<p>它的内部主要是使用@import注解导入一个选择器。</p>
<p>那么我们看看这个AutoConfigurationImportSelector类</p>
<p>上文提到继承ImportSelector接口的类，需要重写 selectImports( )，那我们就看看这个方法</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#E5C07B"> String</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">selectImports</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75"> annotationMetadata) {</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#E06C75"> (</span><span style="color:#56B6C2">!</span><span style="color:#61AFEF">isEnabled</span><span style="color:#E06C75">(annotationMetadata)) {</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#E06C75"> NO_IMPORTS</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#E5C07B">        AutoConfigurationEntry</span><span style="color:#E06C75"> autoConfigurationEntry </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> getAutoConfigurationEntry</span><span style="color:#E06C75">(annotationMetadata)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#E5C07B"> StringUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toStringArray</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">autoConfigurationEntry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getConfigurations</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"></span></code></pre>
<p>该方法其实也没说啥，现在的重心就放在getAutoConfigurationEntry()中。</p>
<p>getAutoConfigurationEntry()</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">protected</span><span style="color:#E5C07B"> AutoConfigurationEntry</span><span style="color:#61AFEF"> getAutoConfigurationEntry</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75"> annotationMetadata) {</span></span>
<span class="line"><span style="color:#C678DD">  if</span><span style="color:#E06C75"> (</span><span style="color:#56B6C2">!</span><span style="color:#61AFEF">isEnabled</span><span style="color:#E06C75">(annotationMetadata)) {</span></span>
<span class="line"><span style="color:#C678DD">      return</span><span style="color:#E06C75"> EMPTY_ENTRY</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">  }　　　　　</span></span>
<span class="line"><span style="color:#E5C07B">  AnnotationAttributes</span><span style="color:#E06C75"> attributes </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> getAttributes</span><span style="color:#E06C75">(annotationMetadata)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  //获取候选配置信息,加载的是当前项目的classpath目录下的所有的 spring.factories 文件中的 key 为</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  //org.springframework.boot.autoconfigure.EnableAutoConfiguration 的信息。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  //点进去通过"SpringFactoriesLoader"进行加载</span></span>
<span class="line"><span style="color:#E5C07B">  List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> configurations </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> getCandidateConfigurations</span><span style="color:#E06C75">(annotationMetadata</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> attributes)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // removeDuplicates方法的作用是 移除同名的</span></span>
<span class="line"><span style="color:#E06C75">  configurations </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> removeDuplicates</span><span style="color:#E06C75">(configurations)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // 获取我们配置的 exclude 信息</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // 比如：@SpringBootApplication(exclude = {RabbitAutoConfiguration.class}) ,显示的指定不要加载那个配置类</span></span>
<span class="line"><span style="color:#E5C07B">  Set</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75"> exclusions </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> getExclusions</span><span style="color:#E06C75">(annotationMetadata</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> attributes)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#61AFEF">  checkExcludedClasses</span><span style="color:#E06C75">(configurations</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> exclusions)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">  configurations</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">removeAll</span><span style="color:#ABB2BF">(exclusions);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // filter的作用是 过滤掉咱们不需要使用的配置类。</span></span>
<span class="line"><span style="color:#E06C75">  configurations </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> getConfigurationClassFilter</span><span style="color:#E06C75">()</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(configurations);</span></span>
<span class="line"><span style="color:#61AFEF">  fireAutoConfigurationImportEvents</span><span style="color:#E06C75">(configurations</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> exclusions)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> AutoConfigurationEntry</span><span style="color:#E06C75">(configurations</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> exclusions)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
<p>前面几个都好理解，现在我们主要看看filter()，是怎么移除不需要的类</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/2597186-20220218230920130-226480162.png" alt="img" loading="lazy" decoding="async"></p>
<p>我们可以看到有具体的匹配方法 match。里面有个关键的属性是 autoConfigurationMetadata , 的本质是 加载的 META-INF/spring-autoconfigure-metadata.properties 的文件中的内容。</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/2597186-20220218231102908-1017908901.png" alt="img" loading="lazy" decoding="async"></p>
<p>其实原理很简单，如果没有对应的实现类，就不进行加载。</p>
<h4 id="何时进行自动装配">何时进行自动装配</h4>
<ul>
<li>处理@Configuration的核心还是ConfigurationClassPostProcessor，这个类实现了BeanFactoryPostProcessor,</li>
<li>因此当AbstractApplicationContext执行refresh方法里的invokeBeanFactoryPostProcessors(beanFactory)方法时会执行自动装配</li>
</ul>
<h4 id="run-方法">run 方法</h4>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">SpringBootApplication</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> SpringBootVipDemoApplication</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> main</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">[] </span><span style="color:#E06C75;font-style:italic">args</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // 基于配置文件的方式</span></span>
<span class="line"><span style="color:#E5C07B">        ApplicationContext</span><span style="color:#E06C75"> ac1</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> ClassPathXmlApplicationContext</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">""</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // 基于Java配置类的方式</span></span>
<span class="line"><span style="color:#E5C07B">        ApplicationContext</span><span style="color:#E06C75"> ac2</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> AnnotationConfigApplicationContext</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">SpringBootVipDemoApplication</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // run 方法的返回对象是 ConfigurableApplicationContext 对象,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //ConfigurableApplicationContext就是ApplicationContext的一个子接口</span></span>
<span class="line"><span style="color:#E5C07B">        ConfigurableApplicationContext</span><span style="color:#E06C75"> ac3</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> SpringApplication</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">run</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">SpringBootVipDemoApplication</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">, args);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>根据返回结果，我们猜测SpringBoot项目的启动其实就是Spring的初始化操作【IOC】。</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/2597186-20220218232932423-556100027.png" alt="img" loading="lazy" decoding="async"></p>
<h3 id="什么是-starter">什么是 Starter</h3>
<p>starter 是“一站式服务（one-stop）”的依赖 jar 包：</p>
<ul>
<li>包含Spring以及相关技术（比如 Redis）的所有依赖</li>
<li>提供了自动配置的功能，开箱即用</li>
<li>提供了良好的依赖管理，避免了包遗漏、版本冲突等问题。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230819192249343.png" alt="image-20230819192249343" loading="lazy" decoding="async"></p>
<h3 id="maven-中的可选依赖">Maven 中的可选依赖</h3>
<p>可选依赖（optional）的作用：阻断“<strong>依赖传递</strong>”</p>
<h3 id="spring-中的注解处理器">Spring 中的注解处理器</h3>
<p>注解处理器：在编译阶段，生成指定注解的元数据。</p>
<ul>
<li>spring-boot-configuration-processor</li>
<li>spring-boot-autoconfigure-processor</li>
</ul>
<h3 id="自定义装换器">自定义装换器</h3>
<ol>
<li>实现WebMvcConfigurer： 不会覆盖WebMvcAutoConfiguration的配置。</li>
<li>实现WebMvcConfigurer+注解@EnableWebMvc：会覆盖WebMvcAutoConfiguration的配置。</li>
<li>继承WebMvcConfigurationSupport：会覆盖WebMvcAutoConfiguration的配置。</li>
<li>继承DelegatingWebMvcConfiguration：会覆盖WebMvcAutoConfiguration的配置。</li>
</ol>
<h4 id="webmvcconfigurationadapter">WebMvcConfigurationAdapter</h4>
<ul>
<li>WebMvcConfigurerAdapter 是 WebMvcConfigurer 的实现类大部分为空方法，是 WebMvcConfigurer的子类实现，由于Java8中可以使用default关键字为接口添加默认方法，为在源代码中spring5.0之后就已经弃用本类，如果需要可以实现WebMvcConfigurer类。</li>
<li><code>WebMvcConfigurationAdapter</code>已经废弃，最好用<code>WebMvcConfigurer</code>代替。</li>
</ul>
<h4 id="webmvcconfigurationsupport">WebMvcConfigurationSupport</h4>
<ul>
<li>WebMvcConfigurationSupport 是mvc的基本实现并包含了WebMvcConfigurer接口中的方法。</li>
</ul>
<h4 id="webmvcautoconfiguration">WebMvcAutoConfiguration</h4>
<ul>
<li>
<p>WebMvcAutoConfiguration 是mvc的自动装在类并部分包含了WebMvcConfigurer接口中的方法。</p>
</li>
<li>
<p>springboot会自动启用WebMvcAutoConfiguration类做自动加载；项目中的配置都是默认的，比如静态资源文件的访问。</p>
</li>
<li>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ConditionalOnWebApplication</span><span style="color:#E06C75">(</span><span style="color:#D19A66">type</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Type</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">SERVLET</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ConditionalOnClass</span><span style="color:#E06C75">({ </span><span style="color:#E5C07B">Servlet</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> DispatcherServlet</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> WebMvcConfigurer</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75"> })</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ConditionalOnMissingBean</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">WebMvcConfigurationSupport</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">AutoConfigureOrder</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">Ordered</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">HIGHEST_PRECEDENCE</span><span style="color:#56B6C2"> +</span><span style="color:#D19A66"> 10</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">AutoConfigureAfter</span><span style="color:#E06C75">({ </span><span style="color:#E5C07B">DispatcherServletAutoConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">    TaskExecutionAutoConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> ValidationAutoConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75"> })</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> WebMvcAutoConfiguration</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  ...</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<ul>
<li>@ConditionalOnMissingBean({WebMvcConfigurationSupport.class})，当Spring容器中不存在WebMvcConfigurationSupportbean，WebMvcAutoConfiguration才会注入。</li>
<li>如果有配置文件继承了DelegatingWebMvcConfiguration，或者WebMvcConfigurationSupport，或者配置类注解了@EnableWebMvc，那么WebMvcAutoConfiguration 将不会被自动配置，而是使用WebMvcConfigurationSupport的配置。那么所有实现了WebMvcConfigurer的配置类有可能会全部失效。</li>
</ul>
</li>
</ul>
<h4 id="webmvcconfigurer">WebMvcConfigurer</h4>
<ul>
<li>
<p>用途：跨域、拦截器、静态资源处理。</p>
</li>
<li>
<p>接口方法的作用：</p>
</li>
</ul>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="text"><code><span class="line"><span>  addInterceptors：拦截器</span></span>
<span class="line"><span>  addViewControllers：页面跳转</span></span>
<span class="line"><span>  addResourceHandlers：静态资源</span></span>
<span class="line"><span>  configureDefaultServletHandling：默认静态资源处理器</span></span>
<span class="line"><span>  configureViewResolvers：视图解析器</span></span>
<span class="line"><span>  configureContentNegotiation：配置内容裁决的一些参数</span></span>
<span class="line"><span>  addCorsMappings：跨域</span></span>
<span class="line"><span>  configureMessageConverters：信息转换器</span></span>
<span class="line"><span></span></span></code></pre>
<ul>
<li>
<p>WebMvcConfigurer配置类其实是<code>Spring</code>内部的种配置方式，可以自定义一些Handler，Interceptor，ViewResolver，MessageConverter等等的东西对springmvc框架进行配置。</p>
</li>
<li>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyWebMvcConfigurer</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> WebMvcConfigurer</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> configureMessageConverters</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">HttpMessageConverter</span><span style="color:#ABB2BF">&lt;</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75;font-style:italic">converters</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建fastJson消息转换器</span></span>
<span class="line"><span style="color:#E5C07B">        FastJsonHttpMessageConverter</span><span style="color:#E06C75"> converter</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> FastJsonHttpMessageConverter</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">MediaType</span><span style="color:#ABB2BF">&gt; </span><span style="color:#E06C75">supportedMediaTypes</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> ArrayList</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">MediaType</span><span style="color:#ABB2BF">&gt;();</span></span>
<span class="line"><span style="color:#E5C07B">        MediaType</span><span style="color:#E06C75"> mediaTypeJson</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> MediaType</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">valueOf</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">APPLICATION_JSON_UTF8_VALUE</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        supportedMediaTypes</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(mediaTypeJson);</span></span>
<span class="line"><span style="color:#E5C07B">        converter</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setSupportedMediaTypes</span><span style="color:#ABB2BF">(supportedMediaTypes);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建配置类</span></span>
<span class="line"><span style="color:#E5C07B">        FastJsonConfig</span><span style="color:#E06C75"> config</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> FastJsonConfig</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        config</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getSerializeConfig</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Json</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> SwaggerJsonSerializer</span><span style="color:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //修改配置返回内容的过滤</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //WriteNullListAsEmpty  ：List字段如果为null,输出为[],而非null</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //WriteNullStringAsEmpty ： 字符类型字段如果为null,输出为"",而非null</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //DisableCircularReferenceDetect ：消除对同一对象循环引用的问题，默认为false（如果不配置有可能会进入死循环）</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //WriteNullBooleanAsFalse：Boolean字段如果为null,输出为false,而非null</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //WriteMapNullValue：是否输出值为null的字段,默认为false</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //WriteDateUseDateFormat：全局修改日期格式，不添加会导致@JsonFormat失效</span></span>
<span class="line"><span style="color:#E5C07B">        config</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setSerializerFeatures</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">SerializerFeature</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">WriteMapNullValue</span></span>
<span class="line"><span style="color:#ABB2BF">                , </span><span style="color:#E5C07B">SerializerFeature</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">WriteNonStringKeyAsString</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                SerializerFeature</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">WriteNullListAsEmpty</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                SerializerFeature</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">DisableCircularReferenceDetect</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                SerializerFeature</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">WriteDateUseDateFormat</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                SerializerFeature</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">WriteNullBooleanAsFalse</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        converter</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setFastJsonConfig</span><span style="color:#ABB2BF">(config);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //将fastjson添加到视图消息转换器列表内</span></span>
<span class="line"><span style="color:#E5C07B">        converters</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, converter);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //WebMvcConfigurer失效</span></span>
<span class="line"><span style="color:#E5C07B">        converters</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(converter);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>默认已经有多个消息转换器了。而 configureMessageConverters 方法中是一个 list 参数。直接向其中添加 HttpMessageConverter后，默认是排在最后的。就造成了你自定义的消息转换器不生效。其实是被其他转换器接管了。因此，想要让我们自定义的消息转换器生效只需要把它添加到list 的第一个就可以了。</p>
</li>
<li>
<p>SerializerFeature属性</p>
<p><img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230203141903620.png" alt="image-20230203141903620" loading="lazy" decoding="async"></p>
</li>
</ul>
<h4 id="enablewebmvc">@EnableWebMVC</h4>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">DelegatingWebMvcConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> EnableWebMvc</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>如果引用了<code>@EnableWebMVC</code>注解，就会往spring容器中注入了一个<code>DelegatingWebMvcConfiguration</code>来统一管理所有的配置类。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> DelegatingWebMvcConfiguration</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> WebMvcConfigurationSupport</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  private</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> WebMvcConfigurerComposite</span><span style="color:#E06C75"> configurers </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> WebMvcConfigurerComposite</span><span style="color:#E06C75">()</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  ...</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<h5 id="失效问题解决">失效问题解决</h5>
<ol>
<li>
<p>在类上加注解解决失效问题</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">EnableWebMvc</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> WebMvcConfig</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> WebMvcConfigurer</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>@EnableWebMvc表示完全自己控制mvc配置，也就是说所有配置自己重写，所有默认配置都没了！有时会导致很多请求进不来，或者参数转换出错之类的，因为spring mvc默认的转换器已经不生效了,包括全局配置的Jackson也会失效，所以在大多数情况下我们需要的是在其基础配置上添加自定义配置。</p>
</li>
<li>
<p>注解+继承解决失效问题</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">EnableWebMvc</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> WebMvcConfig</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> WebMvcAutoConfiguration</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> WebMvcConfigurer</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
</li>
</ol>
<p>@SpringBootApplication</p>
<ul>
<li>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Inherited</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">SpringBootConfiguration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">EnableAutoConfiguration</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">ComponentScan</span><span style="color:#E06C75">(</span><span style="color:#D19A66">excludeFilters</span><span style="color:#56B6C2"> =</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Filter</span><span style="color:#E06C75">(</span><span style="color:#D19A66">type</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> FilterType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">CUSTOM</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> classes</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> TypeExcludeFilter</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Filter</span><span style="color:#E06C75">(</span><span style="color:#D19A66">type</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> FilterType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">CUSTOM</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#D19A66">        classes</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> AutoConfigurationExcludeFilter</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">) })</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> SpringBootApplication</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">AliasFor</span><span style="color:#E06C75">(</span><span style="color:#D19A66">annotation</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> EnableAutoConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#E5C07B">  Class</span><span style="color:#56B6C2">&lt;</span><span style="color:#C678DD">?</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">exclude</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">AliasFor</span><span style="color:#E06C75">(</span><span style="color:#D19A66">annotation</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> EnableAutoConfiguration</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">excludeName</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">AliasFor</span><span style="color:#E06C75">(</span><span style="color:#D19A66">annotation</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> ComponentScan</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> attribute</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "basePackages"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">scanBasePackages</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">AliasFor</span><span style="color:#E06C75">(</span><span style="color:#D19A66">annotation</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> ComponentScan</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> attribute</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "basePackageClasses"</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#E5C07B">  Class</span><span style="color:#56B6C2">&lt;</span><span style="color:#C678DD">?</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">scanBasePackageClasses</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<ul>
<li>这里引用了<code>@EnableAutoConfiguration</code>注解</li>
</ul>
</li>
</ul>
<p>@EnableAutoConfiguration</p>
<ul>
<li>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Inherited</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">AutoConfigurationPackage</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">AutoConfigurationImportSelector</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> EnableAutoConfiguration</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#E06C75"> ENABLED_OVERRIDE_PROPERTY </span><span style="color:#56B6C2">=</span><span style="color:#98C379"> "spring.boot.enableautoconfiguration"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">  Class</span><span style="color:#56B6C2">&lt;</span><span style="color:#C678DD">?</span><span style="color:#56B6C2">&gt;</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">exclude</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">  String</span><span style="color:#E06C75">[] </span><span style="color:#61AFEF">excludeName</span><span style="color:#E06C75">() </span><span style="color:#C678DD">default</span><span style="color:#E06C75"> {}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>注解<code>@AutoConfigurationPackage</code>的主要作用就是：将主程序类所在包及所有子包下的组件到扫描到spring容器中。</p>
</li>
<li>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Target</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">ElementType</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">TYPE</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Retention</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">RetentionPolicy</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">RUNTIME</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Documented</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Inherited</span></span>
<span class="line"><span style="color:#ABB2BF">@</span><span style="color:#E5C07B">Import</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">AutoConfigurationPackages</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Registrar</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">class</span><span style="color:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#ABB2BF"> @</span><span style="color:#C678DD">interface</span><span style="color:#E5C07B"> AutoConfigurationPackage</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p><code>AutoConfigurationImportSelector</code>的作用可以参考：<a href="https://blog.csdn.net/qq_39482039/article/details/120585957">springboot源码自动装配-AutoConfigurationImportSelector</a></p>
</li>
<li>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> AutoConfigurationImportSelector</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> DeferredImportSelector</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> BeanClassLoaderAware</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">    ResourceLoaderAware</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> BeanFactoryAware</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> EnvironmentAware</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> Ordered</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  ...</span></span>
<span class="line"><span style="color:#ABB2BF">  @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">  public</span><span style="color:#E5C07B"> String</span><span style="color:#61AFEF">[] selectImports</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AnnotationMetadata</span><span style="color:#E06C75;font-style:italic"> annotationMetadata</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 是否启用自动配置</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#61AFEF">isEnabled</span><span style="color:#ABB2BF">(annotationMetadata)) {</span></span>
<span class="line"><span style="color:#C678DD">      return</span><span style="color:#ABB2BF"> NO_IMPORTS;</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 获取META-INF/spring-autoconfigure-metadata.properties文件的配置，返回AutoConfigurationMetadata类</span></span>
<span class="line"><span style="color:#E5C07B">    AutoConfigurationMetadata</span><span style="color:#E06C75"> autoConfigurationMetadata</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> AutoConfigurationMetadataLoader</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">loadMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">beanClassLoader</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 获取自动配置类，返回AutoConfigurationEntry</span></span>
<span class="line"><span style="color:#E5C07B">    AutoConfigurationEntry</span><span style="color:#E06C75"> autoConfigurationEntry</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> getAutoConfigurationEntry</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">        autoConfigurationMetadata, annotationMetadata);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // 返回要自动配置的类名</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#E5C07B"> StringUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toStringArray</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">autoConfigurationEntry</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getConfigurations</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">  ...</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>如果引用了<code>@EnableAutoConfiguration</code>注解，就会往spring容器中注入两个类。</p>
<ol>
<li><code>AutoConfigurationPackages.Registrar</code>：扫包。</li>
<li><code>AutoConfigurationImportSelector</code>：等所有类全加载到spring容器之后扫描配置类。</li>
</ol>
</li>
</ul>
<h3 id="junit">junit</h3>
<p>spring boot 2，在进行单元测试的时候，<strong>不支持.yml文件</strong>，配件文件需要设置为properties。</p>
<p>pom 中增加testResources，其他操作按照正常创建 test 流程即可。</p>
<pre class="astro-code one-dark-pro" style="color:#abb2bf;white-space:pre-wrap;word-wrap:break-word;background-color:#282c34;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">build</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">resources</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;</span><span style="color:#E06C75">resource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">                &lt;</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;${basedir}/config/${build.profile.id}/&lt;/</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;/</span><span style="color:#E06C75">resource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;</span><span style="color:#E06C75">resource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">                &lt;</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;${basedir}/src/main/resources/&lt;/</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;/</span><span style="color:#E06C75">resource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;/</span><span style="color:#E06C75">resources</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">finalName</span><span style="color:#ABB2BF">&gt;xxxx&lt;/</span><span style="color:#E06C75">finalName</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">testResources</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;</span><span style="color:#E06C75">testResource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">                &lt;</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;${basedir}/config/${build.profile.id}/&lt;/</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;/</span><span style="color:#E06C75">testResource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;</span><span style="color:#E06C75">testResource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">                &lt;</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;${basedir}/src/main/resources/&lt;/</span><span style="color:#E06C75">directory</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;/</span><span style="color:#E06C75">testResource</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;/</span><span style="color:#E06C75">testResources</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">build</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span></code></pre>
<h2 id="疑问">疑问</h2> </article> <ul class="astro-vj4tpspi my-8"> <li class="inline-block astro-blwjyjpt my-1 underline-offset-4"> <a href="/astro/tags/java/" class="astro-blwjyjpt group pr-2 text-sm" data-astro-transition-scope="astro-36ssibgs-2"> <svg xmlns="http://www.w3.org/2000/svg" class="astro-blwjyjpt scale-75"><path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" class="astro-blwjyjpt"></path> </svg>
&nbsp;<span class="astro-blwjyjpt">java</span> </a> </li> <li class="inline-block astro-blwjyjpt my-1 underline-offset-4"> <a href="/astro/tags/spring/" class="astro-blwjyjpt group pr-2 text-sm" data-astro-transition-scope="astro-36ssibgs-3"> <svg xmlns="http://www.w3.org/2000/svg" class="astro-blwjyjpt scale-75"><path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" class="astro-blwjyjpt"></path> </svg>
&nbsp;<span class="astro-blwjyjpt">spring</span> </a> </li>  </ul> <div class="astro-vj4tpspi flex items-center flex-col-reverse gap-6 justify-between sm:flex-row-reverse sm:gap-4 sm:items-end"> <button id="back-to-top" class="astro-vj4tpspi focus-outline hover:opacity-75 py-1 whitespace-nowrap"> <svg xmlns="http://www.w3.org/2000/svg" class="astro-vj4tpspi rotate-90"> <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" class="astro-vj4tpspi"></path> </svg> <span class="astro-vj4tpspi">Back to Top</span> </button> <div class="astro-wkojbtzc social-icons"> <span class="astro-wkojbtzc italic">Share this post on:</span> <div class="astro-wkojbtzc text-center"> <a href="https://wa.me/?text=https://chou401.github.io/astro/posts/spring-definition-integrated-impl/" class="astro-wkojbtzc group hover:text-skin-accent inline-block link-button" title="Share this post via WhatsApp"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9"></path>
      <path d="M9 10a0.5 .5 0 0 0 1 0v-1a0.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a0.5 .5 0 0 0 0 -1h-1a0.5 .5 0 0 0 0 1"></path>
    </svg> <span class="astro-wkojbtzc sr-only">Share this post via WhatsApp</span> </a><a href="https://www.facebook.com/sharer.php?u=https://chou401.github.io/astro/posts/spring-definition-integrated-impl/" class="astro-wkojbtzc group hover:text-skin-accent inline-block link-button" title="Share this post on Facebook"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3"></path>
  </svg> <span class="astro-wkojbtzc sr-only">Share this post on Facebook</span> </a><a href="https://twitter.com/intent/tweet?url=https://chou401.github.io/astro/posts/spring-definition-integrated-impl/" class="astro-wkojbtzc group hover:text-skin-accent inline-block link-button" title="Tweet this post"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
    </svg> <span class="astro-wkojbtzc sr-only">Tweet this post</span> </a><a href="https://t.me/share/url?url=https://chou401.github.io/astro/posts/spring-definition-integrated-impl/" class="astro-wkojbtzc group hover:text-skin-accent inline-block link-button" title="Share this post via Telegram"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4"></path>
      </svg> <span class="astro-wkojbtzc sr-only">Share this post via Telegram</span> </a><a href="https://pinterest.com/pin/create/button/?url=https://chou401.github.io/astro/posts/spring-definition-integrated-impl/" class="astro-wkojbtzc group hover:text-skin-accent inline-block link-button" title="Share this post on Pinterest"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <line x1="8" y1="20" x2="12" y2="11"></line>
      <path d="M10.7 14c.437 1.263 1.43 2 2.55 2c2.071 0 3.75 -1.554 3.75 -4a5 5 0 1 0 -9.7 1.7"></path>
      <circle cx="12" cy="12" r="9"></circle>
    </svg> <span class="astro-wkojbtzc sr-only">Share this post on Pinterest</span> </a><a href="mailto:?subject=See%20this%20post&amp;body=https://chou401.github.io/astro/posts/spring-definition-integrated-impl/" class="astro-wkojbtzc group hover:text-skin-accent inline-block link-button" title="Share this post via email"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <rect x="3" y="5" width="18" height="14" rx="2"></rect>
      <polyline points="3 7 12 13 21 7"></polyline>
    </svg> <span class="astro-wkojbtzc sr-only">Share this post via email</span> </a> </div> </div>  </div> </main> <footer class="astro-sz7xmlte mt-auto"> <div class="max-w-3xl mx-auto px-0"> <hr class="border-skin-line" aria-hidden="true"> </div> <div class="astro-sz7xmlte footer-wrapper"> <div class="astro-upu6fzxr flex social-icons"> <a href="https://github.com/chou401/astro" class="inline-block group hover:text-skin-accent link-button astro-upu6fzxr" title=" 知道的越多，才知知道的越少 on Github"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
  </svg> <span class="sr-only astro-upu6fzxr"> 知道的越多，才知知道的越少 on Github</span> </a><a href="https://github.com/chou401/astro" class="inline-block group hover:text-skin-accent link-button astro-upu6fzxr" title="知道的越多，才知知道的越少 on Facebook"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3"></path>
  </svg> <span class="sr-only astro-upu6fzxr">知道的越多，才知知道的越少 on Facebook</span> </a><a href="https://github.com/chou401/astro" class="inline-block group hover:text-skin-accent link-button astro-upu6fzxr" title="知道的越多，才知知道的越少 on Instagram"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <rect x="4" y="4" width="16" height="16" rx="4"></rect>
    <circle cx="12" cy="12" r="3"></circle>
    <line x1="16.5" y1="7.5" x2="16.5" y2="7.501"></line>
  </svg> <span class="sr-only astro-upu6fzxr">知道的越多，才知知道的越少 on Instagram</span> </a><a href="https://github.com/chou401/astro" class="inline-block group hover:text-skin-accent link-button astro-upu6fzxr" title="知道的越多，才知知道的越少 on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon-tabler" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <rect x="4" y="4" width="16" height="16" rx="2"></rect>
    <line x1="8" y1="11" x2="8" y2="16"></line>
    <line x1="8" y1="8" x2="8" y2="8.01"></line>
    <line x1="12" y1="16" x2="12" y2="11"></line>
    <path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
  </svg> <span class="sr-only astro-upu6fzxr">知道的越多，才知知道的越少 on LinkedIn</span> </a> </div>  <div class="astro-sz7xmlte copyright-wrapper"> <span class="astro-sz7xmlte">Copyright © 2024</span> <span class="astro-sz7xmlte separator">&nbsp;|&nbsp;</span> <span class="astro-sz7xmlte">All rights reserved.</span> </div> </div> </footer>     <script>function addHeadingLinks(){let c=Array.from(document.querySelectorAll("h2, h3, h4, h5, h6"));for(let d of c){d.classList.add("group");let t=document.createElement("a");t.innerText="#",t.className="heading-link hidden group-hover:inline-block ml-2",t.href="#"+d.id,t.ariaHidden="true",d.appendChild(t)}}addHeadingLinks();function attachCopyButtons(){let c="Copy",d=Array.from(document.querySelectorAll("pre"));for(let e of d){let o=document.createElement("div");o.style.position="relative";let n=document.createElement("button");n.className="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium",n.innerHTML=c,e.setAttribute("tabindex","0"),e.appendChild(n),e?.parentNode?.insertBefore(o,e),o.appendChild(e),n.addEventListener("click",async()=>{await t(e,n)})}async function t(e,o){let i=e.querySelector("code")?.innerText;await navigator.clipboard.writeText(i??""),o.innerText="Copied",setTimeout(()=>{o.innerText=c},700)}}attachCopyButtons();function backToTop(){document.querySelector("#back-to-top")?.addEventListener("click",()=>{document.body.scrollTop=0,document.documentElement.scrollTop=0})}backToTop();
</script></body></html>